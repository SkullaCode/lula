let MainContainer="MainContainer",ModalContainer="modal-container",TemplateContainer="container-panel";window.Controller=function(){let a=function(a,c){b[a]=c},b={AddProperty:a,AddMethod:function(b,c){a(b,c)},FormSubmit:null,FileSelect:null,ModalSelect:null,PanelSelect:null};return b}(),window.Service=function(){let a=function(a,c){b[a]=c},b={LoadedModal:null,LoadedPanel:null,LoadedForm:null,PanelLoading:[],ModalLoading:null,ActionLoading:null,ModelData:{},MetaData:{},ContainerPanel:null,Title:"Javascript UI",Modification:null,SubmitTransformation:null,Transformation:null,DomEvents:null,Data:null,Action:null,ErrorHandler:null,SuccessHandler:null,NotificationHandler:null,ErrorMessageHandler:null,ErrorDataHandler:null,SuccessMessageHandler:null,SuccessDataHandler:null,DefaultModalHandler:null,DefaultElementHandler:null,ServerRequest:null,LaunchModal:null,Bind:null,BindForm:null,GetProperty:null,ListUpdate:null,TriggerEvents:null,ImagePreview:null,LoadPanel:null,LoadLayout:null,LoadPanelTransition:null,SelectListBuilder:null,FindElement:null,Transform:null,ExecuteCustom:null,ExecuteSubmitTransformation:null,ReloadPanel:null,ToasterNotification:null,AlertNotification:null,LoadingStateOn:null,LoadingStateOff:null,CanSubmitForm:null,Bootstrap:null,AddProperty:a,AddMethod:function(b,c){a(b,c)},SYSTEM_ID:"id",SYSTEM_PROPERTY:"property",SYSTEM_TARGET:"target",SYSTEM_COMPLETE:"complete",SYSTEM_HEADERS:"headers",SYSTEM_ACTION:"action",SYSTEM_CUSTOM:"custom",SYSTEM_URL:"href",SYSTEM_METHOD:"method",SYSTEM_PRE_FORM_EXECUTION:"pre",SYSTEM_HISTORY:"history",SYSTEM_FILE_UPLOAD_CONTAINER:".file-upload",SYSTEM_CLEAR_ERROR:"clear-error",SYSTEM_CLEAR_SUCCESS:"clear-success",SYSTEM_LIST:"list",SYSTEM_BIND:"bind",SYSTEM_BIND_VALUE:"bind-value",SYSTEM_BIND_META:"bind-meta",SYSTEM_BIND_ELEM:"bind-element",SYSTEM_BIND_GLOBAL:"bind-global",SYSTEM_LOOP:"loop",SYSTEM_BIND_LOOP:"bind-loop",SYSTEM_SUCCESS_HANDLER:"success-handler",SYSTEM_ERROR_HANDLER:"error-handler",SYSTEM_LOAD_TYPE:"load-type",SYSTEM_NOTIFICATION_ON_SUCCESS:"notification-success",SYSTEM_NOTIFICATION_ON_ERROR:"notification-error",SYSTEM_NOTIFICATION:"notification",SYSTEM_TITLE:"title"};return b}(),window.Service.AddProperty("Modification",function(){let a={AddMethod:function(b,c){a[b]=c}};return a}()),window.Service.AddProperty("SubmitTransformation",function(){let a={AddMethod:function(b,c){a[b]=c}};return a}()),window.Service.AddProperty("Transformation",function(){let a={AddMethod:function(b,c){a[b]=c}};return a}()),window.Service.AddProperty("Data",function(){let a={AddMethod:function(b,c){a[b]=c},Store:{}};return a}()),window.Service.AddProperty("Action",function(){let a={AddMethod:function(b,c){a[b]=c},Store:{}};return a}()),Service.AddProperty("ErrorHandler",function(a){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea,button").each(function(){let a=jQuery(this);a.hasClass(Service.SYSTEM_CLEAR_ERROR)&&("select-one"===a.prop("type")?a.prop("selectedIndex",0):a.is("input")?a.val(""):a.is("textarea")&&a.val(""))})}),Service.AddProperty("SuccessHandler",function(a){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea,button").each(function(){let a=jQuery(this);a.hasClass(Service.SYSTEM_CLEAR_SUCCESS)&&("select-one"===a.prop("type")?a.prop("selectedIndex",0):a.is("input")?a.val(""):a.is("textarea")&&a.val(""))})}),Service.AddProperty("NotificationHandler",function(a){switch(a.notificationType){case"alert":"function"==typeof Service.AlertNotification?Service.AlertNotification(a):alert(a.message);break;case"toaster":"function"==typeof Service.ToasterNotification?Service.ToasterNotification(a):alert(a.message);break;case"none":break;default:"success"===a.status?"function"==typeof Service.ToasterNotification?Service.ToasterNotification(a):alert(a.message):"function"==typeof Service.AlertNotification?Service.AlertNotification(a):alert(a.message)}}),Service.AddProperty("DefaultElementHandler",function(b){let a=jQuery("<div></div>",{class:"alert alert-danger"});return a.append("<p>The panel you are trying to load experienced an error while rendering....</p>"),a}),Service.AddProperty("DefaultModalHandler",function(a,e){if(!a.hasClass("modal")){let c=a.find(".modal");if(1===c.length)return c;{let b=a.data(Service.SYSTEM_ACTION);"string"!=typeof b&&(b="");let d=a.html();return jQuery(`<div class="modal fade" role="dialog" data-action="${b}">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title"></h4>
                            </div>
                            <div class="modal-body">
                                ${d}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>`)}}}),Service.AddProperty("ErrorMessageHandler",function(a,b){return a}),Service.AddProperty("ErrorDataHandler",function(b){let a={Code:b.statusText,Entity:"Application"};if(b.responseText.length>0)try{a=JSON.parse(b.responseText)}catch(c){a.Code="An error occurred on the server",a.Entity="Application"}return a}),Service.AddProperty("SuccessMessageHandler",function(a){return a.statusText}),Service.AddProperty("SuccessDataHandler",function(c,a){let b=a.getResponseHeader("Content-Type");return"application/json"===b?a.responseJSON:"text/html"===b||"text/plain"===b?a.responseText:null}),Service.AddProperty("ServerRequest",function(a){void 0!==a.method&&(a.request=a.method),a.request=void 0!==a.request&&null!==a.request&&a.request?a.request.toUpperCase():"POST",void 0!==a.headers&&null!==a.headers&&a.headers||(a.headers=[]),void 0!==a.success&&null!==a.success&&a.success||(a.success=Service.SuccessHandler),void 0!==a.error&&null!==a.error&&a.error||(a.error=Service.ErrorHandler),void 0!==a.component&&null!==a.component&&a.component||(a.component=jQuery("<div></div>")),void 0!==a.responseType&&null!==a.responseType&&a.responseType||(a.responseType="json"),void 0!==a.actionBtn&&null!==a.actionBtn&&a.actionBtn||(a.actionBtn=jQuery("<button></button>",{type:"button"})),null===a.params&&(a.params={}),Service.LoadingStateOn(a.actionBtn);let c=function(d,e,c){if(Service.LoadingStateOff(a.actionBtn),c.getResponseHeader("X-Reload")){location.reload();return}if(c.getResponseHeader("X-Redirect")){location.href=c.getResponseHeader("X-Redirect");return}let b={};b.status=e,b.message=Service.SuccessMessageHandler(c),b.data=Service.SuccessDataHandler(d,c),b.actionBtn=a.actionBtn,b.component=a.component,b.notificationType=a.actionBtn.data(Service.SYSTEM_NOTIFICATION_ON_SUCCESS)||"toaster",(void 0===a.actionBtn.data(Service.SYSTEM_NOTIFICATION)||"true"===a.actionBtn.data(Service.SYSTEM_NOTIFICATION)||"success"===a.actionBtn.data(Service.SYSTEM_NOTIFICATION))&&Service.NotificationHandler(b),a.success(b),Service.ExecuteCustom(a.complete,a.component,a.actionBtn,b).then(()=>{Service.ActionLoading=!1})},b={url:a.site,type:a.request,success:c,error:function(b,e,f){if(200===b.status){c({},"success",b);return}if(401===b.status||403===b.status){location.href=location.origin;return}Service.LoadingStateOff(a.actionBtn);let d={status:e,actionBtn:a.actionBtn,component:a.component,notificationType:"alert"};d.message=Service.ErrorMessageHandler(f,b),d.data=Service.ErrorDataHandler(b),a.error(d),Service.ExecuteCustom(a.complete,a.component,a.actionBtn,d).then(()=>{(void 0===a.actionBtn.data(Service.SYSTEM_NOTIFICATION)||"true"===a.actionBtn.data(Service.SYSTEM_NOTIFICATION)||"error"===a.actionBtn.data(Service.SYSTEM_NOTIFICATION))&&(void 0!==a.actionBtn.data(Service.SYSTEM_NOTIFICATION_ON_ERROR)&&(d.notificationType=a.actionBtn.data(Service.SYSTEM_NOTIFICATION_ON_ERROR)),500===b.status||(d.status="error",d.message="Oops!"),Service.NotificationHandler(d)),Service.ActionLoading=!1})},beforeSend:function(b){b.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.headers.length>0&&jQuery.each(a.headers,function(){b.setRequestHeader(this.Name,this.Value)})}};["POST","PUT","HEAD","DELETE"].indexOf(a.request.toUpperCase())>=0&&(b.data=a.params),b.dataType=a.responseType,b.processData=!1,b.contentType=!1,b.global=!1,jQuery.ajax(b)}),Service.AddProperty("LaunchModal",function(a,b){return new Promise(function(c){a.on("hide.bs.modal",function(a){}),a.on("hidden.bs.modal",function(){Service.LoadedModal.remove(),Service.LoadedModal=null,jQuery(`.${ModalContainer}`).empty()});let d=a.data(Service.SYSTEM_ACTION);if("string"==typeof d){let e=Service.Data[d];void 0!==e?e(a,b).then(()=>{a.modal(),c(!0)}):(a.modal(),c(!0))}else a.modal(),c(!0)})}),Service.AddProperty("Bind",function(a,d,e=null){let b=a.find(`.${Service.SYSTEM_BIND}`);jQuery.each(b,function(){let a=jQuery(this);if(a.hasClass(Service.SYSTEM_BIND_GLOBAL)){if(void 0!==a.data(Service.SYSTEM_CUSTOM)){let i=a.data(Service.SYSTEM_CUSTOM).split("|");i.forEach(function(b){Service.Transformation.hasOwnProperty(b)?Service.Transformation[b](a,d,e):Controller.hasOwnProperty(b)&&Controller[b](a,d,e)})}return}if("SELECT"===a.prop("tagName")){let g=a.data(Service.SYSTEM_LIST);if(void 0!==g){let h=Service.ModelData.List[g];void 0!==h&&Service.SelectListBuilder(a,h)}}if("IMG"===a.prop("tagName"))void 0!==a.data(Service.SYSTEM_PROPERTY)?a.prop("src",Service.GetProperty(a.data(Service.SYSTEM_PROPERTY),d)):void 0!==a.prop("id")&&a.prop("src",Service.GetProperty(a.prop("id"),d));else if(void 0!==a.data(Service.SYSTEM_PROPERTY)){let b=Service.GetProperty(a.data(Service.SYSTEM_PROPERTY),d);if(void 0===a.data(Service.SYSTEM_CUSTOM)||a.hasClass(Service.SYSTEM_BIND_ELEM)||(b=Service.Transform(a.data(Service.SYSTEM_CUSTOM),null,b,e)),a.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(a.data(Service.SYSTEM_CUSTOM),a,b,e);else if(a.hasClass(Service.SYSTEM_BIND_VALUE)){if(a.is("input,select,textarea")&&a.val(b),a.attr("data-value",b),a.data("value",b),"SELECT"===a.prop("tagName")){let j=a.find("option");a.prop("selectedIndex",0),j.each(function(c){this.value==b&&a.prop("selectedIndex",c)})}}else a.html(b)}else if(void 0!==a.data(Service.SYSTEM_LOOP)){let f=Service.GetProperty(a.data(Service.SYSTEM_LOOP),d),l=a.children();a.empty(),"object"==typeof f&&null!==f&&f.length>0&&f.forEach(function(d){let b=l.clone(),c=b.find(`.${Service.SYSTEM_BIND_LOOP}`);$.each(c,function(){let a=jQuery(this);if(void 0!==a.data(Service.SYSTEM_PROPERTY)){let b=Service.GetProperty(a.data(Service.SYSTEM_PROPERTY),d);if(void 0===a.data(Service.SYSTEM_CUSTOM)||a.hasClass(Service.SYSTEM_BIND_ELEM)||(b=Service.Transform(a.data(Service.SYSTEM_CUSTOM),null,b,e)),a.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(a.data(Service.SYSTEM_CUSTOM),a,b,e);else if(a.hasClass(Service.SYSTEM_BIND_VALUE)){if(a.is("input,select,textarea")&&a.val(b),a.attr("data-value",b),a.data("value",b),"SELECT"===a.prop("tagName")){let f=a.find("option");a.prop("selectedIndex",0),f.each(function(c){this.value==b&&a.prop("selectedIndex",c)})}}else a.html(b)}else{let c=Service.GetProperty(a.prop("id"),d);if(void 0===a.data(Service.SYSTEM_CUSTOM)||a.hasClass(Service.SYSTEM_BIND_ELEM)||(c=Service.Transform(a.data(Service.SYSTEM_CUSTOM),null,c,e)),a.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(a.data(Service.SYSTEM_CUSTOM),a,c,e);else if(a.hasClass(Service.SYSTEM_BIND_VALUE)){if(a.is("input,select,textarea")&&a.val(c),a.attr("data-value",c),a.data("value",c),"SELECT"===a.prop("tagName")){let g=a.find("option");a.prop("selectedIndex",0),g.each(function(b){this.value==c&&a.prop("selectedIndex",b)})}}else a.html(c)}}),a.append(b)}),void 0!==a.data(Service.SYSTEM_CUSTOM)&&(a=Service.Transform(a.data(Service.SYSTEM_CUSTOM),a,e))}else{let c=Service.GetProperty(a.prop("id"),d);if(void 0===a.data(Service.SYSTEM_CUSTOM)||a.hasClass(Service.SYSTEM_BIND_ELEM)||(c=Service.Transform(a.data(Service.SYSTEM_CUSTOM),null,c,e)),a.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(a.data(Service.SYSTEM_CUSTOM),a,c,e);else if(a.hasClass(Service.SYSTEM_BIND_VALUE)){if(a.is("input,select,textarea")&&a.val(c),a.attr("data-value",c),a.data("value",c),"SELECT"===a.prop("tagName")){let k=a.find("option");a.prop("selectedIndex",0),k.each(function(b){this.value==c&&a.prop("selectedIndex",b)})}}else a.html(c)}});let c=a.find(`.${Service.SYSTEM_BIND_META}`);jQuery.each(c,function(){let a=jQuery(this);if("IMG"===a.prop("tagName"))void 0!==a.prop("id")&&a.prop("src",Service.GetProperty(a.prop("id"),Service.MetaData));else if(void 0!==a.prop("id")){let b=Service.GetProperty(a.prop("id"),Service.MetaData);if(void 0!==a.data(Service.SYSTEM_CUSTOM)){let c=Service.Transformation[a.data(Service.SYSTEM_CUSTOM)];void 0!==c&&(b=c(b))}a.html(b)}})}),Service.AddProperty("BindForm",function(h,e){if(null===e|| void 0===h)return;let c=jQuery(h).find("input,select,textarea");if(!(c.length<=0)){for(let f=0;f<c.length;f++){let b=null,a=jQuery(c[f]);if((null==(b=Service.GetProperty(a.prop("id"),e))||"object"==typeof b)&&(b=Service.GetProperty(a.prop("name"),e)),"select-one"===a[0].type){let i=a.data(Service.SYSTEM_LIST);if(void 0!==i){let j=Service.ModelData.List[i];void 0!==j&&Service.SelectListBuilder(a,j)}}if(null!=b&&"object"!=typeof b)switch(a[0].type){case"checkbox":case"radio":a.prop("checked",b==a.val());break;case"hidden":case"color":case"datetime":case"datetime-local":case"email":case"number":case"month":case"range":case"search":case"tel":case"time":case"url":case"week":case"text":case"textarea":case"password":a.data("value",b),a.val(b);break;case"date":if(b){let d=new Date(b),k=("0"+d.getDate()).slice(-2),l=("0"+(d.getMonth()+1)).slice(-2);d=d.getFullYear()+"-"+l+"-"+k,a.data("value",d),a.val(d)}else a.val("");break;case"select-one":{a.data("value",b);let m=a.find("option");a.prop("selectedIndex",0),m.each(function(c){this.value==b&&a.prop("selectedIndex",c)})}}}for(let g=0;c&&g<c.length;g++)Service.TriggerEvents(jQuery(c[g]))}}),Service.AddProperty("GetProperty",function(a,d){if(null==a)return d;a=a.split(".");let b=d;if(void 0===b)return null;for(let c=0;c<a.length&&!(a[c].length<=0)&&null!==(b=b[a[c]])&& void 0!==b&&"object"==typeof b;c++);return b}),Service.AddProperty("ListUpdate",function(a,f){if((a=jQuery(a)).val()){let d=a.data(Service.SYSTEM_URL);if(void 0!==d){let g=`${d}/${a.val()}`,h="GET",i={},j=a.data(Service.SYSTEM_COMPLETE)||null,k=function(a){Service.SelectListBuilder(jQuery(f),a.data,a.actionBtn)},c={site:g,method:h,params:i,success:k};c.actionBtn=a,c.complete=j,Service.ServerRequest(c)}else{let e=a.data(Service.SYSTEM_ACTION);if(void 0!==e){let b=Service.ModelData.List[e];void 0!==b&& void 0!==(b=b[a.val()])&&Service.SelectListBuilder(jQuery(f),b,a)}}}}),Service.AddProperty("TriggerEvents",function(a){let b=a.prop("onclick"),c=a.prop("onchange"),d=a.prop("onblur");null!==b&&a.click(),null!==c&&a.change(),null!==d&&a.blur()}),Service.AddProperty("ImagePreview",function(a,c){if(1===a.length&&a[0].files[0]){let b=new FileReader;b.onload=function(a){c.prop("src",a.target.result)},b.readAsDataURL(a[0].files[0])}}),Service.AddProperty("LoadPanel",function(a,b,c){return new Promise(f=>{if(void 0!==a&&"object"==typeof a){let e=jQuery("<div></div>"),d=a.data(Service.SYSTEM_ACTION);if(Service.Data.hasOwnProperty(d)||(d=`${b[0].dataset[Service.SYSTEM_ACTION]}-data`),Service.Data.hasOwnProperty(d))Service.Data[d](a,b).then(()=>{Service.ContainerPanel=jQuery(`#${TemplateContainer}`),Service.ContainerPanel.length<=0&&(jQuery("<body>").append(e),Service.ContainerPanel=e),Service.ContainerPanel.empty().append(a);let b=null!=c&&c.length>0?jQuery(`#${c}`):jQuery(`#${MainContainer}`);return Service.LoadPanelTransition(b,a),Service.ContainerPanel.empty(),Service.ContainerPanel=null,Service.LoadedPanel=a,e.empty().remove(),f(!0)});else{Service.ContainerPanel=jQuery(`#${TemplateContainer}`),Service.ContainerPanel.length<=0&&(jQuery("<body>").append(e),Service.ContainerPanel=e),Service.ContainerPanel.empty().append(a);let g=null!=c&&c.length>0?jQuery(`#${c}`):jQuery(`#${MainContainer}`);return Service.LoadPanelTransition(g,a),Service.ContainerPanel.empty(),Service.ContainerPanel=null,Service.LoadedPanel=a,e.empty().remove(),f(!0)}}f(!1)})}),Service.AddProperty("SelectListBuilder",function(a,c,e,d=!0){d&&a.empty();let b=a.data("default");b&&a.append(`<option data-value="" value=""> ${b} </option>`),jQuery.each(c,function(){a.append(`<option data-value="${this.Value}" value="${this.Value}"> ${this.Text} </option>`)})}),Service.AddProperty("FindElement",function(a,b=null){return new Promise(g=>{let d=jQuery("template").prop("content");d=jQuery(d);let e="";if(void 0!==a&&a.length>0&&("#"!==a.substring(0,1)&&(a=`#${a}`),e=d.find(a)),e.length>0){let f=jQuery(e[0]).clone(),h=f.data(Service.SYSTEM_ACTION),c=jQuery(f.html());1!==c.length&&(c=jQuery("<div></div>").append(f.html())),void 0!==h&&c.data(Service.SYSTEM_ACTION,h),g(c)}else{let i=jQuery("<div></div>");i.append(Service.DefaultElementHandler(b)),g(i)}})}),Service.AddProperty("FindLocalElement",function(a,h=null){let c=jQuery("template").prop("content");c=jQuery(c),"#"!==a.substring(0,1)&&(a=`#${a}`);let e=c.find(a);if(e.length>0){let d=jQuery(e[0]).clone(),f=d.data(Service.SYSTEM_ACTION),b=jQuery(d.html());return 1!==b.length&&(b=jQuery("<div></div>").append(d.html())),void 0!==f&&b.data(Service.SYSTEM_ACTION,f),b}{let g=jQuery("<div></div>");return g.append(Service.DefaultElementHandler(h)),g}}),Service.AddProperty("ExecuteCustom",function(a,b,c,d=null){return new Promise(function(e){if(null!=a&&a.length>0)return(a=a.split("|")).forEach(function(a){Service.Modification.hasOwnProperty(a)?Service.Modification[a](b,c,d):Controller.hasOwnProperty(a)&&Controller[a](b,c,d)}),e(!0);e(!1)})}),Service.AddProperty("Transform",function(a,c,b,d){return"string"==typeof a&&a.length>0&&(a=a.split("|")).forEach(function(a){null===c?Service.Transformation.hasOwnProperty(a)?b=Service.Transformation[a](b,d):Controller.hasOwnProperty(a)&&(b=Controller[a](b,d)):Service.Transformation.hasOwnProperty(a)?Service.Transformation[a](c,b,d):Controller.hasOwnProperty(a)&&Controller[a](c,b,d)}),b}),Service.AddProperty("ExecuteSubmitTransformation",function(a,c,b,d){return(a=a.split("|")).forEach(function(a){Service.SubmitTransformation.hasOwnProperty(a)?b=Service.SubmitTransformation[a](c,b,d):Controller.hasOwnProperty(a)&&(c=Controller[a](c,b,d))}),b}),Service.AddProperty("LoadingStateOn",function(a){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea").prop("disabled",!0),a.prop("disabled",!0)}),Service.AddProperty("LoadingStateOff",function(a){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea").prop("disabled",!1),a.prop("disabled",!1)}),Service.AddProperty("LoadPanelTransition",function(a,b,c=null){a.css("display","none"),a.empty(),a.html(b).fadeIn("slow")}),Service.AddProperty("Bootstrap",function(a=null){Service.ModelData.List={},setTimeout(async function(){await Controller.PanelSelect(document.getElementById(`${MainContainer}`)),null!==a&&await Controller.PanelSelect(a[0])},1e3)}),Controller.AddProperty("FormSubmit",function(v,p){if(void 0!==p?p.preventDefault():window.event.preventDefault(),Service.ActionLoading)return!1;let a=jQuery(v);Service.ActionLoading=!0,Service.CanSubmitForm=!0;let b=a.data(Service.SYSTEM_TARGET),q=a.data(Service.SYSTEM_CUSTOM),r=a.data(Service.SYSTEM_COMPLETE),h=a.data(Service.SYSTEM_HEADERS),f="",c="",g=new FormData,i=[],s=[];if(void 0===b)b="",Service.LoadedForm=jQuery(a.parents("form"));else{let j=a.data(Service.SYSTEM_ACTION),k=a.data(Service.SYSTEM_METHOD);"#"!==b.substring(0,1)&&(b=`#${b}`);let e=jQuery(document).find(b),d=e.is("form")?e:e.find("form");if(d.length>0)Service.LoadedForm=d,void 0!==j&&d.attr("action",j),void 0!==k&&d.attr("method",k);else{let w=e.clone();(d=jQuery("<form></form>",{action:j,method:k})).append(w.children());let x=e.find("select");jQuery(x).each(function(a){d.find("select").eq(a).val(jQuery(this).val())}),Service.LoadedForm=d}}if(Service.LoadedForm.length<=0)return Service.ActionLoading=!1,!1;if(void 0!==h&&Controller.hasOwnProperty(h)&&(i=Controller[h]()),s=jQuery(Service.LoadedForm.serializeArray()),jQuery.each(s,function(){g.append(this.name,this.value)}),f=Service.LoadedForm[0].action,c=Service.LoadedForm[0].method,void 0===f)return!1;void 0===c&&(c="POST"),c=c.toUpperCase();let t=Service.LoadedForm.find("input[type='file']");if(t.length>0&&jQuery(t).each(function(a){if(t[a].files.length>1){let b=t[a].name;"]"!==b.substring(b.length-1,b.length)&&(b=`${t[a].name}[]`);for(let c=0;c<t[a].files.length;c++)g.append(b,t[a].files[c])}else g.append(t[a].name,t[a].files[0])}),void 0!==q&&(g=Service.ExecuteSubmitTransformation(q,Service.LoadedForm,g)),!1===Service.CanSubmitForm)return Service.ActionLoading=!1,!1;let l=Service.SuccessHandler,m=Service.ErrorHandler,n=a.data(Service.SYSTEM_SUCCESS_HANDLER),o=a.data(Service.SYSTEM_ERROR_HANDLER);void 0!==n&&Controller.hasOwnProperty(n)&&(l=Controller[n]),void 0!==o&&Controller.hasOwnProperty(o)&&(m=Controller[o]);let u=Service.Action[b];void 0!==u?u({params:g,success:l,error:m,headers:i,complete:r,site:f,request:c,actionBtn:a,component:Service.LoadedForm}):Service.ServerRequest({params:g,success:l,error:m,headers:i,complete:r,site:f,request:c,actionBtn:a,component:Service.LoadedForm})}),Controller.AddProperty("FileSelect",function(f){if(Service.ActionLoading)return!1;let a=jQuery(f);Service.ActionLoading=!0;let d=a.data(Service.SYSTEM_ACTION),e=a.data(Service.SYSTEM_COMPLETE),b=void 0===d?jQuery(a.parents(Service.SYSTEM_FILE_UPLOAD_CONTAINER)):jQuery(document).find(`#${d}`),c=b.find("input[type=file]"),g=b.find("img");c.click(),c.change(function(){Service.ImagePreview(c,g)}),c.change(),void 0!==e&&Service.ExecuteCustom(e,b,a),Service.ActionLoading=!1}),Controller.AddProperty("ModalSelect",function(b){if(Service.ModalLoading)return!1;let a=jQuery(b);if(Service.ModalLoading=!0,a.data(Service.SYSTEM_LOAD_TYPE,"modal"),null===Service.LoadedModal){let c=a.data(Service.SYSTEM_ACTION);Service.FindElement(c,a).then(b=>{Service.LoadedModal=b,Service.LoadedModal.hasClass("modal")||(Service.LoadedModal=Service.DefaultModalHandler(b,a));let c=jQuery(`#${ModalContainer}`);c.empty().append(Service.LoadedModal);let d=a.data(),e=[Service.SYSTEM_ACTION,Service.SYSTEM_COMPLETE];jQuery.each(d,function(a,b){-1===jQuery.inArray(a,e)&&Service.LoadedModal.data(a,b)}),Service.ExecuteCustom(a.data(Service.SYSTEM_CUSTOM),Service.LoadedModal,a).then(()=>{Service.LaunchModal(Service.LoadedModal,a).then(()=>{Service.ExecuteCustom(a.data(Service.SYSTEM_COMPLETE),Service.LoadedModal,a).then(()=>{Service.ModalLoading=!1})})})})}else Service.ModalLoading=!1}),Controller.AddProperty("PanelSelect",function(b){let a=jQuery(b),c=a.data(Service.SYSTEM_ACTION);if(-1!==jQuery.inArray(c,Service.PanelLoading))return!1;Service.PanelLoading.push(a.data(Service.SYSTEM_ACTION)),a.data(Service.SYSTEM_LOAD_TYPE,"panel");let d=a.data(Service.SYSTEM_HISTORY);Service.FindElement(a.data(Service.SYSTEM_ACTION),a).then(f=>{let b={},g=[Service.SYSTEM_ACTION,Service.SYSTEM_COMPLETE,Service.SYSTEM_TARGET,Service.SYSTEM_CUSTOM,Service.SYSTEM_HISTORY,Service.SYSTEM_NOTIFICATION_ON_SUCCESS,Service.SYSTEM_NOTIFICATION_ON_ERROR,Service.SYSTEM_NOTIFICATION,Service.SYSTEM_TITLE];jQuery.each(a.data(),function(a,c){-1!==jQuery.inArray(a,g)?b[a]=c:"string"==typeof c&&(b[a]=c)}),void 0===d&&window.history.pushState({data:b,panelSelect:!0},"");let e=void 0!==a.data(Service.SYSTEM_TITLE)?a.data(Service.SYSTEM_TITLE):a.data(Service.SYSTEM_ACTION);window.document.title=`${Service.Title} - ${e}`,Service.ExecuteCustom(a.data(Service.SYSTEM_CUSTOM),Service.LoadedPanel,a).then(()=>{Service.LoadPanel(f,a,a.data(Service.SYSTEM_TARGET)).then(()=>{Service.ExecuteCustom(a.data(Service.SYSTEM_COMPLETE),Service.LoadedPanel,a).then(()=>{let a=Service.PanelLoading.indexOf(c);Service.PanelLoading.splice(a,1)})})})})}),Controller.AddProperty("ReloadPanel",function(){let a=jQuery("<button></button>",{type:"button","data-notification":"false"});Service.LoadPanel(Service.LoadedPanel,a)}),Controller.AddProperty("UpdateSecondaryList",function(a){(a=jQuery(a)).data(Service.SYSTEM_NOTIFICATION,!1);let b=jQuery(document).find(`#${a.data(Service.SYSTEM_TARGET)}`);b&&Service.ListUpdate(a,b)}),window.onpopstate=function(c){let a=c.state;if(null!==a&&a.panelSelect){let b=jQuery("<a>");jQuery.each(a.data,function(a,c){b.attr(`data-${a}`,c)}),b.attr("data-history",!0),Controller.PanelSelect(b[0])}}