class Result{Code=null;Status=null;Message=null;Data=null;ActionBtn=null;Component=null;NotificationType=null}class Requirement{Site="";Method=null;Request="POST";Notification="true";Headers=[];SuccessHandler=null;ErrorHandler=null;Component=null;ActionBtn=null;ResponseType=null;Params=new FormData;Complete=null}let MainContainer="MainContainer",ModalContainer="modal-container",TemplateContainer="container-panel";const HARD_RELOAD_HEADER="x-reload-app",HARD_REDIRECT_HEADER="x-redirect-app",TOASTER_NOTIFICATION_TYPE="toaster",ALERT_NOTIFICATION_TYPE="alert",NONE_NOTIFICATION_TYPE="none";window.Controller=function(){let e=function(e,n){t[e]=n},t={AddProperty:e,AddMethod:function(t,n){e(t,n)},FormSubmit:null,FileSelect:null,ModalSelect:null,PanelSelect:null};return t}(),window.Service=function(){let e=function(e,n){t[e]=n},t={LoadedModal:null,LoadedPanel:{},LoadedForm:null,PanelLoading:[],ModalLoading:null,ActionLoading:null,ModelData:{Lists:{},Listing:[],SelectedEntity:{}},MetaData:{},ContainerPanel:null,Title:"Javascript UI",Modification:null,SubmitTransformation:null,Transformation:null,DomEvents:null,Data:null,AuthorizationHandler:null,ErrorHandler:null,SuccessHandler:null,NotificationHandler:null,ErrorMessageHandler:null,ErrorDataHandler:null,SuccessMessageHandler:null,SuccessDataHandler:null,DefaultModalHandler:null,DefaultElementHandler:null,ServerRequest:null,LaunchModal:null,Bind:null,BindForm:null,BindList:null,GetProperty:null,ListUpdate:null,TriggerEvents:null,ImagePreview:null,LoadPanel:null,LoadModal:null,LoadData:null,LoadLayout:null,LoadPanelTransition:null,SelectListBuilder:null,FindElement:null,Transform:null,ExecuteCustom:null,ExecuteSubmitTransformation:null,ReloadPanel:null,ToasterNotification:null,AlertNotification:null,LoadingStateOn:null,LoadingStateOff:null,CanSubmitForm:null,Bootstrap:null,FindElementSync:null,FormData:null,Link:null,AddProperty:e,AddMethod:function(t,n){e(t,n)},SYSTEM_ID:"id",SYSTEM_PROPERTY:"property",SYSTEM_TARGET:"target",SYSTEM_COMPLETE:"complete",SYSTEM_HEADERS:"headers",SYSTEM_ACTION:"action",SYSTEM_CUSTOM:"custom",SYSTEM_URL:"href",SYSTEM_METHOD:"method",SYSTEM_HISTORY:"history",SYSTEM_FILE_UPLOAD_CONTAINER:".file-upload",SYSTEM_CLEAR_ERROR:"clear-error",SYSTEM_CLEAR_SUCCESS:"clear-success",SYSTEM_LIST:"list",SYSTEM_BIND:"bind",SYSTEM_BIND_VALUE:"bind-value",SYSTEM_BIND_ELEM:"bind-element",SYSTEM_BIND_GLOBAL:"bind-global",SYSTEM_LOOP:"loop",SYSTEM_BIND_LOOP:"bind-loop",SYSTEM_SUCCESS_HANDLER:"success-handler",SYSTEM_ERROR_HANDLER:"error-handler",SYSTEM_LOAD_TYPE:"load-type",SYSTEM_NOTIFICATION_ON_SUCCESS:"notification-success",SYSTEM_NOTIFICATION_ON_ERROR:"notification-error",SYSTEM_NOTIFICATION:"notification",SYSTEM_TITLE:"title",SYSTEM_DEFAULT:"default"};return t}(),window.Service.AddProperty("Modification",function(){let e={AddMethod:function(t,n){e[t]=n}};return e}()),window.Service.AddProperty("SubmitTransformation",function(){let e={AddMethod:function(t,n){e[t]=n}};return e}()),window.Service.AddProperty("Transformation",function(){let e={AddMethod:function(t,n){e[t]=n}};return e}()),window.Service.AddProperty("Data",function(){let e={AddMethod:function(t,n){e[t]=n},Store:{}};return e}()),Service.AddProperty("AuthorizationHandler",(function(e){e.NotificationType="alert",Service.NotificationHandler(e)})),Service.AddProperty("ErrorHandler",(function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea,button").each((function(){let e=jQuery(this);e.hasClass(Service.SYSTEM_CLEAR_ERROR)&&("select-one"===e.prop("type")?e.prop("selectedIndex",0):(e.is("input")||e.is("textarea"))&&e.val(""))}))})),Service.AddProperty("SuccessHandler",(function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea,button").each((function(){let e=jQuery(this);e.hasClass(Service.SYSTEM_CLEAR_SUCCESS)&&("select-one"===e.prop("type")?e.prop("selectedIndex",0):(e.is("input")||e.is("textarea"))&&e.val(""))}))})),Service.AddProperty("NotificationHandler",(function(e){switch(e.NotificationType){case"alert":"function"==typeof Service.AlertNotification?Service.AlertNotification(e):alert(e.Message);break;case"toaster":"function"==typeof Service.ToasterNotification?Service.ToasterNotification(e):alert(e.Message);break;case"none":break;default:"success"===e.Status?"function"==typeof Service.ToasterNotification?Service.ToasterNotification(e):alert(e.Message):"function"==typeof Service.AlertNotification?Service.AlertNotification(e):alert(e.Message)}})),Service.AddProperty("DefaultElementHandler",(function(e){const t=jQuery("<div></div>",{class:"alert alert-danger"});return t.append("<p>The panel you are trying to load experienced an error while rendering....</p>"),t})),Service.AddProperty("DefaultModalHandler",(function(e,t){if(!e.hasClass("modal")){const t=e.find(".modal");if(1===t.length)return t;{let t=e.data(Service.SYSTEM_ACTION);"string"!=typeof t&&(t="");const n=e.html();return jQuery(`<div class="modal fade" role="dialog" data-action="${t}">\n                    <div class="modal-dialog">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <button type="button" class="close" data-dismiss="modal">&times;</button>\n                                <h4 class="modal-title"></h4>\n                            </div>\n                            <div class="modal-body">\n                                ${n}\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>`)}}})),Service.AddProperty("ErrorMessageHandler",(function(e,t,n){let r=e.getResponseHeader("x-error-message");if(null!=r&&r.length>0)return r;if(void 0!==t&&(r=t,null!=r&&r.length>0))return r;if(void 0!==e.responseJSON&&void 0!==e.responseJSON.message&&(r=e.responseJSON.message,null!=r&&r.length>0))return r;if(void 0!==e.responseText&&e.responseText.length>0){try{r=JSON.parse(e.responseText).message}catch(e){r=null}if(null!=r&&r.length>0)return r}return r=e.statusText,null!=r&&r.length>0?r:"Internal Server Error!"})),Service.AddProperty("ErrorDataHandler",(function(e,t,n){let r={};if(void 0!==e.responseJSON)r=e.responseJSON;else if(void 0!==e.responseText&&e.responseText.length>0)try{r=JSON.parse(e.responseText)}catch(e){}return r})),Service.AddProperty("SuccessMessageHandler",(function(e,t,n){let r=e.getResponseHeader("x-success-message");return null!=r&&r.length>0?r:(r=e.statusText,null!=r&&r.length>0||void 0!==t.message&&(r=t.message,null!=r&&r.length>0)?r:"Task completed!")})),Service.AddProperty("SuccessDataHandler",(function(e,t,n){return t})),Service.AddProperty("ServerRequest",(function(e){void 0!==e.Method&&null!==e.Method&&(e.Request=e.Method),void 0!==e.Headers&&null!==e.Headers||(e.Headers=[]),void 0!==e.SuccessHandler&&null!==e.SuccessHandler||(e.SuccessHandler=Service.SuccessHandler),void 0!==e.ErrorHandler&&null!==e.ErrorHandler||(e.ErrorHandler=Service.ErrorHandler),void 0!==e.Component&&null!==e.Component||(e.Component=jQuery("<div></div>")),void 0!==e.ResponseType&&null!==e.ResponseType||(e.ResponseType="json"),void 0===e.ActionBtn||null===e.ActionBtn?(e.ActionBtn=jQuery("<button></button>",{type:"button"}),void 0!==e.Notification&&0!==e.Notification.length||(e.Notification="true")):void 0!==e.Notification&&0!==e.Notification.length||void 0===e.ActionBtn.data(Service.SYSTEM_NOTIFICATION)?e.Notification="true":e.Notification=e.ActionBtn.data(Service.SYSTEM_NOTIFICATION),null===e.Params&&(e.Params=new FormData),Service.LoadingStateOn(e.ActionBtn);const t=function(t,n,r){if(Service.LoadingStateOff(e.ActionBtn),r.getResponseHeader("x-reload-app"))return void location.reload();if(r.getResponseHeader("x-redirect-app"))return void(location.href=r.getResponseHeader("x-redirect-app"));let i=new Result;i.Code=r.statusCode,i.Status=n,i.Data=Service.SuccessDataHandler(r,t,e.ActionBtn),i.Message=Service.SuccessMessageHandler(r,t,e.ActionBtn),i.ActionBtn=e.ActionBtn,i.Component=e.Component,"true"!==e.Notification&&"success"!==e.Notification||(i.NotificationType=e.ActionBtn.data(Service.SYSTEM_NOTIFICATION_ON_SUCCESS)||"toaster",Service.NotificationHandler(i)),e.SuccessHandler(i),void 0!==e.Complete&&null!==e.Complete?Service.ExecuteCustom(e.Complete,e.Component,e.ActionBtn,i).then((()=>{Service.ActionLoading=!1})):void 0!==e.ActionBtn.data(Service.SYSTEM_COMPLETE)&&null!==e.ActionBtn.data(Service.SYSTEM_COMPLETE)?Service.ExecuteCustom(e.ActionBtn.data(Service.SYSTEM_COMPLETE),e.Component,e.ActionBtn,i).then((()=>{Service.ActionLoading=!1})):Service.ActionLoading=!1},n={url:e.Site,type:e.Request,success:t,error:function(n,r,i){if(200===n.status)return void t({},"success",n);const o=new Result;if(o.Code=n.status,o.Status=r,o.ActionBtn=e.ActionBtn,o.Component=e.Component,Service.LoadingStateOff(e.ActionBtn),o.Data=Service.ErrorDataHandler(n,i,e.ActionBtn),o.Message=Service.ErrorMessageHandler(n,i,e.ActionBtn),401===n.status||403===n.status)return Service.AuthorizationHandler(o),void(Service.ActionLoading=!1);e.ErrorHandler(o),void 0!==e.Complete&&null!==e.Complete?Service.ExecuteCustom(e.Complete,e.Component,e.ActionBtn,o).then((()=>{"true"!==e.Notification&&"error"!==e.Notification||(o.NotificationType=e.ActionBtn.data(Service.SYSTEM_NOTIFICATION_ON_ERROR)||"alert",Service.NotificationHandler(o)),Service.ActionLoading=!1})):("true"!==e.Notification&&"error"!==e.Notification||(o.NotificationType=e.ActionBtn.data(Service.SYSTEM_NOTIFICATION_ON_ERROR)||"alert",Service.NotificationHandler(o)),Service.ActionLoading=!1)},beforeSend:function(t){t.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.Headers.length>0&&jQuery.each(e.Headers,(function(){t.setRequestHeader(this.Name,this.Value)}))}};["POST","PUT","HEAD","DELETE"].indexOf(e.Request.toUpperCase())>=0&&(n.data=e.Params),n.dataType=e.ResponseType,n.processData=!1,n.contentType=!1,n.global=!1,jQuery.ajax(n)})),Service.AddProperty("LaunchModal",(function(e,t){return new Promise((function(t){e.on("hide.bs.modal",(function(e){})),e.on("hidden.bs.modal",(function(){Service.LoadedModal.remove(),Service.LoadedModal=null,jQuery(`.${ModalContainer}`).empty()})),e.modal(),t(!0)}))})),Service.AddProperty("Bind",(function(e,t,n=null){let r=[];e.hasClass(`${Service.SYSTEM_BIND}`)?r.push(e):r=e.find(`.${Service.SYSTEM_BIND}`),jQuery.each(r,(function(){let e=jQuery(this);if(e.hasClass(Service.SYSTEM_BIND_GLOBAL)){if(void 0!==e.data(Service.SYSTEM_CUSTOM)){e.data(Service.SYSTEM_CUSTOM).split("|").forEach((function(r){Service.Transformation.hasOwnProperty(r)?Service.Transformation[r](e,t,n):Controller.hasOwnProperty(r)&&Controller[r](e,t,n)}))}}else if("IMG"===e.prop("tagName"))void 0!==e.data(Service.SYSTEM_PROPERTY)?e.prop("src",Service.GetProperty(e.data(Service.SYSTEM_PROPERTY),t)):void 0!==e.prop("id")&&e.prop("src",Service.GetProperty(e.prop("id"),t));else if(void 0!==e.data(Service.SYSTEM_PROPERTY))Service.BindProperty(e,e.data(Service.SYSTEM_PROPERTY),t,n);else if(void 0!==e.data(Service.SYSTEM_LOOP)){let r=Service.GetProperty(e.data(Service.SYSTEM_LOOP),t);if(void 0===r)return;let i=e.children();e.empty(),"object"==typeof r&&null!==r&&r.length>0&&r.forEach((function(t){let o=i.clone(),a=o.find(`.${Service.SYSTEM_BIND_LOOP}`);o.hasClass(`${Service.SYSTEM_BIND_LOOP}`)&&(o.hasClass(Service.SYSTEM_BIND_GLOBAL)?Service.BindProperty(o,null,r,n):void 0!==o.data(Service.SYSTEM_PROPERTY)?Service.BindProperty(o,o.data(Service.SYSTEM_PROPERTY),t,n):Service.BindProperty(o,o.prop("id"),t,n)),a.length>0&&$.each(a,(function(){let e=jQuery(this);e.hasClass(Service.SYSTEM_BIND_GLOBAL)?Service.BindProperty(e,null,r,n):void 0!==e.data(Service.SYSTEM_PROPERTY)?Service.BindProperty(e,e.data(Service.SYSTEM_PROPERTY),t,n):Service.BindProperty(e,e.prop("id"),t,n)})),e.append(o)})),void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e=Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n))}else e.prop("id").length>0&&Service.BindProperty(e,e.prop("id"),t,n)}))})),Service.AddProperty("BindForm",(function(e,t){if(null===t)return;if(void 0===e)return;let n=jQuery(e).find("input,select,textarea");if(!(n.length<=0)){for(let e=0;e<n.length;e++){let r=null,i=jQuery(n[e]);if(r=Service.GetProperty(i.prop("id"),t),null!=r&&"object"!=typeof r||(r=Service.GetProperty(i.prop("name"),t)),null!=r&&"object"!=typeof r)switch(i[0].type){case"checkbox":case"radio":i.prop("checked",r==i.val());break;case"date":if(r){let e=new Date(r),t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2);e=e.getFullYear()+"-"+n+"-"+t,i.data("value",e),i.val(e)}else i.val("");break;case"select-one":{i.data("value",r);let e=i.find("option");i.prop("selectedIndex",0),e.each((function(e){this.value==r&&i.prop("selectedIndex",e)}));break}case"select-multiple":break;default:i.data("value",r),i.val(r)}}for(let e=0;n&&e<n.length;e++)Service.TriggerEvents(jQuery(n[e]))}})),Service.AddProperty("BindList",(function(e,t=[],n=null){if(void 0!==t&&"string"!=typeof t&&null!==t&&"object"==typeof t&&t.length>0)Service.SelectListBuilder(e,t);else{const t=e.find("select");jQuery.each(t,(function(){let e=jQuery(this),t=e.data(Service.SYSTEM_LIST);if(void 0!==t){let r=Service.GetProperty(t,Service.ModelData.Lists);(null==r||r.length<=0)&&Controller.hasOwnProperty(t)&&(r=Controller[t](n)),null!=r&&r.length>0?Service.SelectListBuilder(e,r):e.data(Service.SYSTEM_DEFAULT)&&Service.SelectListBuilder(e,[])}else Service.SelectListBuilder(e,[])}))}})),Service.AddProperty("BindProperty",(function(e,t,n,r){if(null==t||t.length<=0)return void(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||e.hasClass(Service.SYSTEM_BIND_GLOBAL))&&Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n,r));let i=Service.GetProperty(t,n);if(void 0!==i)if(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||(i=Service.Transform(e.data(Service.SYSTEM_CUSTOM),null,i,r))),e.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,i,r);else if(e.hasClass(Service.SYSTEM_BIND_VALUE)){if(e.is("input,select,textarea")&&e.val(i),e.attr("data-value",i),"SELECT"===e.prop("tagName")){let t=e.find("option");e.prop("selectedIndex",0),t.each((function(t){this.value==i&&e.prop("selectedIndex",t)}))}}else e.html(i)})),Service.AddProperty("GetProperty",(function(e,t){if(null===e)return t;if(void 0===e)return t;e=e.split(".");let n=t;if(void 0===n)return null;for(let t=0;t<e.length&&!(e[t].length<=0)&&(n=n[e[t]],null!==n)&&void 0!==n;t++)if("object"!=typeof n)return n;return n})),Service.AddProperty("TriggerEvents",(function(e){let t=e.prop("onclick"),n=e.prop("onchange"),r=e.prop("onblur");null!==t&&e.click(),null!==n&&e.change(),null!==r&&e.blur()})),Service.AddProperty("ImagePreview",(function(e,t){if(1===e.length&&e[0].files[0]){let n=new FileReader;n.onload=function(e){t.prop("src",e.target.result)},n.readAsDataURL(e[0].files[0])}})),Service.AddProperty("LoadPanel",(function(e,t,n){return new Promise((t=>{const r=jQuery("<div></div>");Service.ContainerPanel=jQuery(`#${TemplateContainer}`),Service.ContainerPanel.length<=0&&(jQuery("<body>").append(r),Service.ContainerPanel=r),Service.ContainerPanel.empty().append(e);let i=null!=n&&n.length>0?jQuery(`#${n}`):jQuery(`#${MainContainer}`);return Service.LoadPanelTransition(i,e),Service.ContainerPanel.empty(),Service.ContainerPanel=null,r.empty().remove(),t(e)}))})),Service.AddProperty("LoadModal",(function(e,t){return new Promise((n=>{let r=e;r.hasClass("modal")||(r=Service.DefaultModalHandler(e,t));jQuery(`#${ModalContainer}`).empty().append(r);const i=t.data(),o=[Service.SYSTEM_ACTION,Service.SYSTEM_COMPLETE];jQuery.each(i,(function(e,t){-1===jQuery.inArray(e,o)&&r.data(e,t)})),n(r)}))})),Service.AddProperty("LoadData",(function(e,t){return new Promise((function(n){let r=e.data(Service.SYSTEM_ACTION);Service.Data.hasOwnProperty(r)||(r=`${t.data(Service.SYSTEM_ACTION)}-data`),Service.Data.hasOwnProperty(r)?Service.Data[r](e,t).then((function(e){n(e)})):n(!0)}))})),Service.AddProperty("SelectListBuilder",(function(e,t,n,r=!0){"string"==typeof e&&("#"!==e.substring(0,1)&&(e=`#${e}`),e=jQuery(e)),r&&e.empty();const i=e.data("default");i&&e.append(`<option data-value="" value=""> ${i} </option>`),jQuery.each(t,(function(){let t="",n="";void 0!==this.value&&(t=this.value),0===t.length&&void 0!==this.Value&&(t=this.Value),0===t.length&&void 0!==this.VALUE&&(t=this.VALUE),void 0!==this.text&&(n=this.text),0===n.length&&void 0!==this.Text&&(n=this.Text),0===n.length&&void 0!==this.TEXT&&(n=this.TEXT),e.append(`<option data-value="${t}" value="${t}"> ${n} </option>`)}))})),Service.AddProperty("FindElement",(function(e,t=null){return new Promise((n=>{let r=jQuery("template").prop("content");r=jQuery(r);let i="";if(void 0!==e&&e.length>0&&("#"!==e.substring(0,1)&&(e=`#${e}`),i=r.find(e)),i.length>0){let r=jQuery(i[0]).clone();const o=r.data(Service.SYSTEM_ACTION);let a=jQuery(r.html());1!==a.length&&(a=jQuery("<div></div>").append(r.html())),void 0!==o?a.data(Service.SYSTEM_ACTION,o):a.data(Service.SYSTEM_ACTION,e.substring(1)),Service.BindList(a,[],t),n(a)}else{const e=jQuery("<div></div>");e.append(Service.DefaultElementHandler(t)),n(e)}}))})),Service.AddProperty("FindElementSync",(function(e,t=null){let n=jQuery("template").prop("content");n=jQuery(n);let r="";if(void 0!==e&&e.length>0&&("#"!==e.substring(0,1)&&(e=`#${e}`),r=n.find(e)),r.length>0){let e=jQuery(r[0]).clone();const n=e.data(Service.SYSTEM_ACTION);let i=jQuery(e.html());return 1!==i.length&&(i=jQuery("<div></div>").append(e.html())),void 0!==n&&i.data(Service.SYSTEM_ACTION,n),Service.BindList(i,[],t),i}{const e=jQuery("<div></div>");return e.append(Service.DefaultElementHandler(t)),e}})),Service.AddProperty("ExecuteCustom",(function(e,t,n,r=null){return new Promise((function(i){if(null!=e&&e.length>0)return(e=e.split("|")).forEach((function(e){Service.Modification.hasOwnProperty(e)?Service.Modification[e](t,n,r):Controller.hasOwnProperty(e)&&Controller[e](t,n,r)})),i(!0);i(!1)}))})),Service.AddProperty("Transform",(function(e,t,n,r){return"string"==typeof e&&e.length>0&&(e=e.split("|")).forEach((function(e){null===t?Service.Transformation.hasOwnProperty(e)?n=Service.Transformation[e](n,null,r):Controller.hasOwnProperty(e)&&(n=Controller[e](n,null,r)):Service.Transformation.hasOwnProperty(e)?Service.Transformation[e](t,n,r):Controller.hasOwnProperty(e)&&Controller[e](t,n,r)})),n})),Service.AddProperty("ExecuteSubmitTransformation",(function(e,t,n,r){return(e=e.split("|")).forEach((function(e){Service.SubmitTransformation.hasOwnProperty(e)?n=Service.SubmitTransformation[e](t,n,r):Controller.hasOwnProperty(e)&&(t=Controller[e](t,n,r))})),n})),Service.AddProperty("LoadingStateOn",(function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea").prop("disabled",!0),e.prop("disabled",!0)})),Service.AddProperty("LoadingStateOff",(function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea").prop("disabled",!1),e.prop("disabled",!1)})),Service.AddProperty("LoadPanelTransition",(function(e,t,n=null){e.css("display","none"),e.empty(),e.html(t).fadeIn("slow")})),Service.AddProperty("Bootstrap",(function(e=null){setTimeout((async function(){await Controller.PanelSelect(document.getElementById(`${MainContainer}`)),null!==e&&await Controller.PanelSelect(e[0])}),1e3)})),Service.AddProperty("FormData",(function(e){const t=new FormData;return jQuery.isArray(e)?jQuery.each(e,(function(){t.append(this.name,this.value)})):jQuery.each(e,(function(n){e.hasOwnProperty(n)&&t.append(n,e[n])})),t})),Service.AddProperty("Link",(function(e,t=null,n="",r="error"){const i=jQuery("<a></a>");return i.attr("data-action",e),null!==t&&i.attr("data-target",t),i.attr("data-complete",n),i.attr("data-notification",r),i[0]})),Controller.AddProperty("FormSubmit",(function(e){if(Service.ActionLoading)return!1;const t=jQuery(e);Service.ActionLoading=!0,Service.CanSubmitForm=!0;let n=t.data(Service.SYSTEM_TARGET);void 0===n&&(n=t.data(Service.SYSTEM_ACTION));let r=t.data(Service.SYSTEM_CUSTOM),i=t.data(Service.SYSTEM_COMPLETE),o=t.data(Service.SYSTEM_HEADERS),a=[],l=t.data(Service.SYSTEM_URL),c="post",d=new FormData,S=[],s=[];if(void 0===n)Service.LoadedForm=jQuery(t.parents("form")),void 0!==Service.LoadedForm.attr("action")&&(l=Service.LoadedForm.attr("action")),void 0!==Service.LoadedForm.attr("method")&&(c=Service.LoadedForm.attr("method")),s=Service.LoadedForm.serializeArray();else{"#"!==n.substring(0,1)&&(n=`#${n}`);const e=jQuery(document).find(n);if(a=e.is("form")?e:e.find("form"),a.length>0)Service.LoadedForm=a,l=a.prop("action"),c=a.prop("method"),void 0!==a.data(Service.SYSTEM_URL)&&(l=a.data(Service.SYSTEM_URL)),void 0!==a.data(Service.SYSTEM_METHOD)&&(c=a.data(Service.SYSTEM_METHOD)),s=a.serializeArray();else{const t=e.clone();a=jQuery("<form></form>"),a.append(t.children());const n=e.find("select");jQuery(n).each((function(e){a.find("select").eq(e).val(jQuery(this).val())})),void 0!==e.data(Service.SYSTEM_URL)&&(l=e.data(Service.SYSTEM_URL)),void 0!==e.data(Service.SYSTEM_METHOD)&&(c=e.data(Service.SYSTEM_METHOD)),Service.LoadedForm=e,s=a.serializeArray()}}if(Service.LoadedForm.length<=0)return Service.ActionLoading=!1,!1;if(void 0!==o&&Controller.hasOwnProperty(o)&&(S=Controller[o]()),d=Service.FormData(s),void 0===l||l.length<=0)return Service.ActionLoading=!1,!1;c=c.toUpperCase();const u=Service.LoadedForm.find("input[type='file']");if(u.length>0&&jQuery(u).each((function(e){if(u[e].files.length>1){let t=u[e].name;"]"!==t.substring(t.length-1,t.length)&&(t=`${u[e].name}[]`);for(let n=0;n<u[e].files.length;n++)d.append(t,u[e].files[n])}else d.append(u[e].name,u[e].files[0])})),void 0!==r&&(d=Service.ExecuteSubmitTransformation(r,Service.LoadedForm,d,t)),!1===Service.CanSubmitForm)return Service.ActionLoading=!1,!1;let v=Service.SuccessHandler,p=Service.ErrorHandler,T=t.data(Service.SYSTEM_SUCCESS_HANDLER),E=t.data(Service.SYSTEM_ERROR_HANDLER);void 0!==T&&Controller.hasOwnProperty(T)&&(v=Controller[T]),void 0!==E&&Controller.hasOwnProperty(E)&&(p=Controller[E]);const f=new Requirement;f.Params=d,f.SuccessHandler=v,f.ErrorHandler=p,f.Complete=i,f.Site=l,f.Request=c,f.ActionBtn=t,f.Component=Service.LoadedForm,f.Headers=S,Service.ServerRequest(f)})),Controller.AddProperty("FileSelect",(function(e){if(Service.ActionLoading)return!1;const t=jQuery(e);Service.ActionLoading=!0;let n=t.data(Service.SYSTEM_TARGET),r=t.data(Service.SYSTEM_COMPLETE);const i=void 0===n?jQuery(t.parents(Service.SYSTEM_FILE_UPLOAD_CONTAINER)):jQuery(document).find(`#${n}`);let o=i.find("input[type=file]"),a=i.find("img");o.click(),o.change((function(){Service.ImagePreview(o,a)})),o.change(),void 0!==r&&Service.ExecuteCustom(r,i,t),Service.ActionLoading=!1})),Controller.AddProperty("ModalSelect",(function(e){if(Service.ModalLoading)return!1;const t=jQuery(e);if(Service.ModalLoading=!0,t.data(Service.SYSTEM_LOAD_TYPE,"modal"),null===Service.LoadedModal){let e=t.data(Service.SYSTEM_ACTION);Service.FindElement(e,t).then((e=>{Service.ExecuteCustom(t.data(Service.SYSTEM_CUSTOM),e,t).then((()=>{Service.LoadData(e,t).then((n=>{n?Service.LoadModal(e,t).then((e=>{Service.LaunchModal(e,t).then((()=>{Service.ExecuteCustom(t.data(Service.SYSTEM_COMPLETE),e,t).then((()=>{Service.LoadedModal=e,Service.ModalLoading=!1}))}))})):Service.ModalLoading=!1}))}))}))}else Service.ModalLoading=!1})),Controller.AddProperty("PanelSelect",(function(e){const t=jQuery(e),n=t.data(Service.SYSTEM_ACTION);if(-1!==jQuery.inArray(n,Service.PanelLoading))return!1;Service.PanelLoading.push(t.data(Service.SYSTEM_ACTION)),t.data(Service.SYSTEM_LOAD_TYPE,"panel");const r=t.data(Service.SYSTEM_HISTORY),i={},o=[Service.SYSTEM_ACTION,Service.SYSTEM_COMPLETE,Service.SYSTEM_TARGET,Service.SYSTEM_CUSTOM,Service.SYSTEM_HISTORY,Service.SYSTEM_NOTIFICATION_ON_SUCCESS,Service.SYSTEM_NOTIFICATION_ON_ERROR,Service.SYSTEM_NOTIFICATION,Service.SYSTEM_TITLE];jQuery.each(t.data(),(function(e,t){(-1!==jQuery.inArray(e,o)||"string"==typeof t)&&(i[e]=t)})),void 0===r&&window.history.pushState({data:i,panelSelect:!0},"");const a=void 0!==t.data(Service.SYSTEM_TITLE)?t.data(Service.SYSTEM_TITLE):t.data(Service.SYSTEM_ACTION);window.document.title=`${Service.Title} - ${a}`,Service.FindElement(t.data(Service.SYSTEM_ACTION),t).then((e=>{Service.ExecuteCustom(t.data(Service.SYSTEM_CUSTOM),e,t).then((()=>{Service.LoadData(e,t).then((r=>{const i=void 0!==t.data(Service.SYSTEM_TARGET)&&null!==t.data(Service.SYSTEM_TARGET)&&t.data(Service.SYSTEM_TARGET).length>0?t.data(Service.SYSTEM_TARGET):MainContainer;if(r)Service.LoadPanel(e,t,t.data(Service.SYSTEM_TARGET)).then((e=>{Service.ExecuteCustom(t.data(Service.SYSTEM_COMPLETE),e,t).then((()=>{Service.LoadedPanel[i]={ActionButton:t,LoadedPanel:e}}))}));else{const e=jQuery("<div></div>");e.append(Service.DefaultElementHandler(t)),Service.LoadPanel(e,t,t.data(Service.SYSTEM_TARGET)).then((e=>{Service.LoadedPanel[i]={ActionButton:t,LoadedPanel:e}}))}const o=Service.PanelLoading.indexOf(n);Service.PanelLoading.splice(o,1)}))}))}))})),Controller.AddProperty("ReloadPanel",(function(e=null){if(null===e?e=MainContainer:"string"!=typeof e&&(e=jQuery(e).data("action")),void 0===Service.LoadedPanel[e])return;const t=Service.LoadedPanel[e].LoadedPanel,n=Service.LoadedPanel[e].ActionButton;Service.LoadData(t,n).then((r=>{if(r)Service.LoadPanel(t,n,e).then((t=>{Service.ExecuteCustom(n.data(Service.SYSTEM_COMPLETE),t,n).then((()=>{Service.LoadedPanel[e].LoadedPanel=t}))}));else{const t=jQuery("<div></div>");t.append(Service.DefaultElementHandler(n)),Service.LoadPanel(t,n,e).then((t=>{Service.LoadedPanel[e].LoadedPanel=t}))}}))})),window.onpopstate=function(e){const t=e.state;if(null!==t&&t.panelSelect){const e=jQuery("<a>");jQuery.each(t.data,(function(t,n){e.attr(`data-${t}`,n)})),e.attr("data-history",!0),Controller.PanelSelect(e[0])}};