let MainContainer="MainContainer",ModalContainer="modal-container",TemplateContainer="container-panel";window.Controller=function(){let e=function(e,r){t[e]=r},t={AddProperty:e,AddMethod:function(t,r){e(t,r)},FormSubmit:null,FileSelect:null,ModalSelect:null,PanelSelect:null};return t}(),window.Service=function(){let e=function(e,r){t[e]=r},t={LoadedModal:null,LoadedPanel:null,LoadedForm:null,PanelLoading:[],ModalLoading:null,ActionLoading:null,ModelData:{},MetaData:{},ContainerPanel:null,APIUrl:null,LoadingComplete:!1,Title:"Javascript UI",Modification:null,SubmitTransformation:null,Transformation:null,DomEvents:null,Data:null,Action:null,ErrorHandler:null,SuccessHandler:null,NotificationHandler:null,ErrorMessageHandler:null,ErrorDataHandler:null,SuccessMessageHandler:null,SuccessDataHandler:null,DefaultModalHandler:null,DefaultElementHandler:null,ServerRequest:null,LaunchModal:null,Bind:null,BindForm:null,GetProperty:null,ListUpdate:null,TriggerEvents:null,ImagePreview:null,LoadPanel:null,LoadLayout:null,LoadPanelTransition:null,SelectListBuilder:null,FindElement:null,Transform:null,ExecuteCustom:null,ExecuteSubmitTransformation:null,ReloadPanel:null,ToasterNotification:null,AlertNotification:null,LoadingStateOn:null,LoadingStateOff:null,CanSubmitForm:null,Bootstrap:null,AddProperty:e,AddMethod:function(t,r){e(t,r)},SYSTEM_ID:"id",SYSTEM_PROPERTY:"property",SYSTEM_TARGET:"target",SYSTEM_COMPLETE:"complete",SYSTEM_HEADERS:"headers",SYSTEM_ACTION:"action",SYSTEM_CUSTOM:"custom",SYSTEM_URL:"href",SYSTEM_METHOD:"method",SYSTEM_PRE_FORM_EXECUTION:"pre",SYSTEM_HISTORY:"history",SYSTEM_FILE_UPLOAD_CONTAINER:".file-upload",SYSTEM_CLEAR_ERROR:"clear-error",SYSTEM_CLEAR_SUCCESS:"clear-success",SYSTEM_LIST:"list",SYSTEM_BIND:"bind",SYSTEM_BIND_VALUE:"bind-value",SYSTEM_BIND_META:"bind-meta",SYSTEM_BIND_ELEM:"bind-element",SYSTEM_BIND_GLOBAL:"bind-global",SYSTEM_LOOP:"loop",SYSTEM_BIND_LOOP:"bind-loop",SYSTEM_SUCCESS_HANDLER:"success-handler",SYSTEM_ERROR_HANDLER:"error-handler",SYSTEM_LOAD_TYPE:"load-type",SYSTEM_NOTIFICATION_ON_SUCCESS:"notification-success",SYSTEM_NOTIFICATION_ON_ERROR:"notification-error",SYSTEM_NOTIFICATION:"notification",SYSTEM_TITLE:"title"};return t}(),window.Service.AddProperty("Modification",function(){let e={AddMethod:function(t,r){e[t]=r}};return e}()),window.Service.AddProperty("SubmitTransformation",function(){let e={AddMethod:function(t,r){e[t]=r}};return e}()),window.Service.AddProperty("Transformation",function(){let e={AddMethod:function(t,r){e[t]=r}};return e}()),window.Service.AddProperty("Data",function(){let e={AddMethod:function(t,r){e[t]=r},Store:{}};return e}()),window.Service.AddProperty("Action",function(){let e={AddMethod:function(t,r){e[t]=r},Store:{}};return e}()),Service.AddProperty("ErrorHandler",function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea,button").each(function(){let e=jQuery(this);e.hasClass(Service.SYSTEM_CLEAR_ERROR)&&("select-one"===e.prop("type")?e.prop("selectedIndex",0):e.is("input")?e.val(""):e.is("textarea")&&e.val(""))})}),Service.AddProperty("SuccessHandler",function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea,button").each(function(){let e=jQuery(this);e.hasClass(Service.SYSTEM_CLEAR_SUCCESS)&&("select-one"===e.prop("type")?e.prop("selectedIndex",0):e.is("input")?e.val(""):e.is("textarea")&&e.val(""))})}),Service.AddProperty("NotificationHandler",function(e){switch(e.notificationType){case"alert":"function"==typeof Service.AlertNotification?Service.AlertNotification(e):alert(e.message);break;case"toaster":"function"==typeof Service.ToasterNotification?Service.ToasterNotification(e):alert(e.message);break;case"none":break;default:"success"===e.status?"function"==typeof Service.ToasterNotification?Service.ToasterNotification(e):alert(e.message):"function"==typeof Service.AlertNotification?Service.AlertNotification(e):alert(e.message)}}),Service.AddProperty("DefaultElementHandler",function(e){const t=jQuery("<div></div>",{class:"alert alert-danger"});return t.append("<p>The panel you are trying to load experienced an error while rendering....</p>"),t}),Service.AddProperty("DefaultModalHandler",function(e,t){if(!e.hasClass("modal")){const t=e.find(".modal");if(1===t.length)return t;{let t=e.data(Service.SYSTEM_ACTION);"string"!=typeof t&&(t="");const r=e.html();return jQuery(`<div class="modal fade" role="dialog" data-action="${t}">\n                    <div class="modal-dialog">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <button type="button" class="close" data-dismiss="modal">&times;</button>\n                                <h4 class="modal-title"></h4>\n                            </div>\n                            <div class="modal-body">\n                                ${r}\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>`)}}}),Service.AddProperty("ErrorMessageHandler",function(e,t){return e}),Service.AddProperty("ErrorDataHandler",function(e){let t={Code:e.statusText,Entity:"Application"};if(e.responseText.length>0)try{t=JSON.parse(e.responseText)}catch(e){t.Code="An error occurred on the server",t.Entity="Application"}return t}),Service.AddProperty("SuccessMessageHandler",function(e){return e.statusText}),Service.AddProperty("SuccessDataHandler",function(e,t){const r=t.getResponseHeader("Content-Type");return"application/json"===r?t.responseJSON:"text/html"===r||"text/plain"===r?t.responseText:null}),Service.AddProperty("ServerRequest",function(e){void 0!==e.method&&(e.request=e.method),e.request=void 0!==e.request&&null!==e.request&&e.request?e.request.toUpperCase():"POST",void 0!==e.headers&&null!==e.headers&&e.headers||(e.headers=[]),void 0!==e.success&&null!==e.success&&e.success||(e.success=Service.SuccessHandler),void 0!==e.error&&null!==e.error&&e.error||(e.error=Service.ErrorHandler),void 0!==e.component&&null!==e.component&&e.component||(e.component=jQuery("<div></div>")),void 0!==e.responseType&&null!==e.responseType&&e.responseType||(e.responseType="json"),void 0!==e.actionBtn&&null!==e.actionBtn&&e.actionBtn||(e.actionBtn=jQuery("<button></button>",{type:"button"})),null===e.params&&(e.params={}),Service.LoadingStateOn(e.actionBtn);const t=function(t,r,n){if(Service.LoadingStateOff(e.actionBtn),n.getResponseHeader("X-Reload"))return void location.reload();if(n.getResponseHeader("X-Redirect"))return void(location.href=n.getResponseHeader("X-Redirect"));let a={};a.status=r,a.message=Service.SuccessMessageHandler(n),a.data=Service.SuccessDataHandler(t,n),a.actionBtn=e.actionBtn,a.component=e.component,a.notificationType=e.actionBtn.data(Service.SYSTEM_NOTIFICATION_ON_SUCCESS)||"toaster",void 0!==e.actionBtn.data(Service.SYSTEM_NOTIFICATION)&&"true"!==e.actionBtn.data(Service.SYSTEM_NOTIFICATION)&&"success"!==e.actionBtn.data(Service.SYSTEM_NOTIFICATION)||Service.NotificationHandler(a),e.success(a),Service.ExecuteCustom(e.complete,e.component,e.actionBtn,a).then(()=>{Service.ActionLoading=!1})},r={url:e.site,type:e.request,success:t,error:function(r,n,a){if(200===r.status)return void t({},"success",r);if(401===r.status||403===r.status)return void(location.href=location.origin);Service.LoadingStateOff(e.actionBtn);const i={status:n,actionBtn:e.actionBtn,component:e.component,notificationType:"alert"};i.message=Service.ErrorMessageHandler(a,r),i.data=Service.ErrorDataHandler(r),e.error(i),Service.ExecuteCustom(e.complete,e.component,e.actionBtn,i).then(()=>{if(void 0===e.actionBtn.data(Service.SYSTEM_NOTIFICATION)||"true"===e.actionBtn.data(Service.SYSTEM_NOTIFICATION)||"error"===e.actionBtn.data(Service.SYSTEM_NOTIFICATION))switch(void 0!==e.actionBtn.data(Service.SYSTEM_NOTIFICATION_ON_ERROR)&&(i.notificationType=e.actionBtn.data(Service.SYSTEM_NOTIFICATION_ON_ERROR)),r.status){case 500:Service.NotificationHandler(i);break;case 404:i.status="error",i.message="Oops!",Service.NotificationHandler(i);break;default:i.status="error",i.message="Oops!",Service.NotificationHandler(i)}Service.ActionLoading=!1})},beforeSend:function(t){t.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.headers.length>0&&jQuery.each(e.headers,function(){t.setRequestHeader(this.Name,this.Value)})}};["POST","PUT","HEAD","DELETE"].indexOf(e.request.toUpperCase())>=0&&(r.data=e.params),r.dataType=e.responseType,r.processData=!1,r.contentType=!1,r.global=!1,jQuery.ajax(r)}),Service.AddProperty("LaunchModal",function(e,t){return new Promise(function(r){e.on("hide.bs.modal",function(e){}),e.on("hidden.bs.modal",function(){Service.LoadedModal.remove(),Service.LoadedModal=null,jQuery(`.${ModalContainer}`).empty()});const n=e.data(Service.SYSTEM_ACTION);if("string"==typeof n){let a=Service.Data[n];void 0!==a?a(e,t).then(()=>{e.modal(),r(!0)}):(e.modal(),r(!0))}else e.modal(),r(!0)})}),Service.AddProperty("Bind",function(e,t,r=null){let n=e.find(`.${Service.SYSTEM_BIND}`);jQuery.each(n,function(){let e=jQuery(this);if(e.hasClass(Service.SYSTEM_BIND_GLOBAL)){if(void 0!==e.data(Service.SYSTEM_CUSTOM)){e.data(Service.SYSTEM_CUSTOM).split("|").forEach(function(n){Service.Transformation.hasOwnProperty(n)?Service.Transformation[n](e,t,r):Controller.hasOwnProperty(n)&&Controller[n](e,t,r)})}}else{if("SELECT"===e.prop("tagName")){let t=e.data(Service.SYSTEM_LIST);if(void 0!==t){let r=Service.ModelData.List[t];void 0!==r&&Service.SelectListBuilder(e,r)}}if("IMG"===e.prop("tagName"))void 0!==e.data(Service.SYSTEM_PROPERTY)?e.prop("src",Service.GetProperty(e.data(Service.SYSTEM_PROPERTY),t)):void 0!==e.prop("id")&&e.prop("src",Service.GetProperty(e.prop("id"),t));else if(void 0!==e.data(Service.SYSTEM_PROPERTY)){let n=Service.GetProperty(e.data(Service.SYSTEM_PROPERTY),t);if(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||(n=Service.Transform(e.data(Service.SYSTEM_CUSTOM),null,n,r))),e.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n,r);else if(e.hasClass(Service.SYSTEM_BIND_VALUE)){if(e.is("input,select,textarea")&&e.val(n),e.attr("data-value",n),e.data("value",n),"SELECT"===e.prop("tagName")){let t=e.find("option");e.prop("selectedIndex",0),t.each(function(t){this.value==n&&e.prop("selectedIndex",t)})}}else e.html(n)}else if(void 0!==e.data(Service.SYSTEM_LOOP)){let n=Service.GetProperty(e.data(Service.SYSTEM_LOOP),t),a=e.children();e.empty(),"object"==typeof n&&null!==n&&n.length>0&&n.forEach(function(t){let n=a.clone(),i=n.find(`.${Service.SYSTEM_BIND_LOOP}`);$.each(i,function(){let e=jQuery(this);if(void 0!==e.data(Service.SYSTEM_PROPERTY)){let n=Service.GetProperty(e.data(Service.SYSTEM_PROPERTY),t);if(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||(n=Service.Transform(e.data(Service.SYSTEM_CUSTOM),null,n,r))),e.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n,r);else if(e.hasClass(Service.SYSTEM_BIND_VALUE)){if(e.is("input,select,textarea")&&e.val(n),e.attr("data-value",n),e.data("value",n),"SELECT"===e.prop("tagName")){let t=e.find("option");e.prop("selectedIndex",0),t.each(function(t){this.value==n&&e.prop("selectedIndex",t)})}}else e.html(n)}else{let n=Service.GetProperty(e.prop("id"),t);if(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||(n=Service.Transform(e.data(Service.SYSTEM_CUSTOM),null,n,r))),e.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n,r);else if(e.hasClass(Service.SYSTEM_BIND_VALUE)){if(e.is("input,select,textarea")&&e.val(n),e.attr("data-value",n),e.data("value",n),"SELECT"===e.prop("tagName")){let t=e.find("option");e.prop("selectedIndex",0),t.each(function(t){this.value==n&&e.prop("selectedIndex",t)})}}else e.html(n)}}),e.append(n)}),void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e=Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,r))}else{let n=Service.GetProperty(e.prop("id"),t);if(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||(n=Service.Transform(e.data(Service.SYSTEM_CUSTOM),null,n,r))),e.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n,r);else if(e.hasClass(Service.SYSTEM_BIND_VALUE)){if(e.is("input,select,textarea")&&e.val(n),e.attr("data-value",n),e.data("value",n),"SELECT"===e.prop("tagName")){let t=e.find("option");e.prop("selectedIndex",0),t.each(function(t){this.value==n&&e.prop("selectedIndex",t)})}}else e.html(n)}}});let a=e.find(`.${Service.SYSTEM_BIND_META}`);jQuery.each(a,function(){let e=jQuery(this);if("IMG"===e.prop("tagName"))void 0!==e.prop("id")&&e.prop("src",Service.GetProperty(e.prop("id"),Service.MetaData));else if(void 0!==e.prop("id")){let t=Service.GetProperty(e.prop("id"),Service.MetaData);if(void 0!==e.data(Service.SYSTEM_CUSTOM)){let r=Service.Transformation[e.data(Service.SYSTEM_CUSTOM)];void 0!==r&&(t=r(t))}e.html(t)}})}),Service.AddProperty("BindForm",function(e,t){if(null===t)return;if(void 0===e)return;let r=jQuery(e).find("input,select,textarea");if(!(r.length<=0)){for(let e=0;e<r.length;e++){let n=null,a=jQuery(r[e]);if(null!=(n=Service.GetProperty(a.prop("id"),t))&&"object"!=typeof n||(n=Service.GetProperty(a.prop("name"),t)),"select-one"===a[0].type){let e=a.data(Service.SYSTEM_LIST);if(void 0!==e){let t=Service.ModelData.List[e];void 0!==t&&Service.SelectListBuilder(a,t)}}if(null!=n&&"object"!=typeof n)switch(a[0].type){case"checkbox":case"radio":a.prop("checked",n==a.val());break;case"hidden":case"color":a.data("value",n),a.val(n);break;case"date":if(n){let e=new Date(n),t=("0"+e.getDate()).slice(-2),r=("0"+(e.getMonth()+1)).slice(-2);e=e.getFullYear()+"-"+r+"-"+t,a.data("value",e),a.val(e)}else a.val("");break;case"datetime":case"datetime-local":case"email":case"number":a.data("value",n),a.val(n);break;case"month":case"range":case"search":case"tel":case"time":case"url":case"week":case"text":case"textarea":case"password":a.data("value",n),a.val(n);break;case"select-one":{a.data("value",n);let e=a.find("option");a.prop("selectedIndex",0),e.each(function(e){this.value==n&&a.prop("selectedIndex",e)});break}}}for(let e=0;r&&e<r.length;e++)Service.TriggerEvents(jQuery(r[e]))}}),Service.AddProperty("GetProperty",function(e,t){if(null===e)return t;if(void 0===e)return t;e=e.split(".");let r=t;if(void 0===r)return null;for(let t=0;t<e.length&&!(e[t].length<=0)&&null!==(r=r[e[t]])&&void 0!==r;t++)if("object"!=typeof r)return r;return r}),Service.AddProperty("ListUpdate",function(e,t,r){if(e.value.length>0){const n=`${e.dataset[Service.SYSTEM_URL]}/${e.value}`,a="GET",i={},o=r.data(Service.SYSTEM_COMPLETE)||null;let l={site:n,method:a,params:i,success:function(e){Service.SelectListBuilder(jQuery(t),e.data,e.actionBtn)}};r&&(l.actionBtn=r,l.complete=o),Service.ServerRequest(l)}}),Service.AddProperty("TriggerEvents",function(e){let t=e.prop("onclick"),r=e.prop("onchange"),n=e.prop("onblur");null!==t&&e.click(),null!==r&&e.change(),null!==n&&e.blur()}),Service.AddProperty("ImagePreview",function(e,t){if(1===e.length&&e[0].files[0]){let r=new FileReader;r.onload=function(e){t.prop("src",e.target.result)},r.readAsDataURL(e[0].files[0])}}),Service.AddProperty("LoadPanel",function(e,t,r){return new Promise(n=>{if(void 0!==e&&"object"==typeof e){const a=jQuery("<div></div>");let i=e.data(Service.SYSTEM_ACTION);if(!Service.Data.hasOwnProperty(i)){Service.ContainerPanel=jQuery(`#${TemplateContainer}`),Service.ContainerPanel.length<=0&&(jQuery("<body>").append(a),Service.ContainerPanel=a),Service.ContainerPanel.empty().append(e);let t=null!=r&&r.length>0?jQuery(`#${r}`):jQuery(`#${MainContainer}`);return Service.LoadPanelTransition(t,e),Service.ContainerPanel.empty(),Service.ContainerPanel=null,Service.LoadedPanel=e,a.empty().remove(),n(!0)}Service.Data[i](e,t).then(()=>{Service.ContainerPanel=jQuery(`#${TemplateContainer}`),Service.ContainerPanel.length<=0&&(jQuery("<body>").append(a),Service.ContainerPanel=a),Service.ContainerPanel.empty().append(e);let t=null!=r&&r.length>0?jQuery(`#${r}`):jQuery(`#${MainContainer}`);return Service.LoadPanelTransition(t,e),Service.ContainerPanel.empty(),Service.ContainerPanel=null,Service.LoadedPanel=e,a.empty().remove(),n(!0)})}n(!1)})}),Service.AddProperty("SelectListBuilder",function(e,t,r,n=!0){n&&e.empty(),jQuery.each(t,function(){e.append(`<option data-value="${this.Value}" value="${this.Value}"> ${this.Text} </option>`)})}),Service.AddProperty("FindElement",function(e,t=null){return new Promise(r=>{let n=jQuery("template").prop("content");n=jQuery(n);let a="";if(void 0!==e&&e.length>0&&("#"!==e.substring(0,1)&&(e=`#${e}`),a=n.find(e)),a.length>0){let e=jQuery(a[0]).clone();const t=e.data(Service.SYSTEM_ACTION);let n=jQuery(e.html());1!==n.length&&(n=jQuery("<div></div>").append(e.html())),void 0!==t&&n.data(Service.SYSTEM_ACTION,t),r(n)}else{const e=jQuery("<div></div>");e.append(Service.DefaultElementHandler(t)),r(e)}})}),Service.AddProperty("FindLocalElement",function(e,t=null){let r=jQuery("template").prop("content");r=jQuery(r),"#"!==e.substring(0,1)&&(e=`#${e}`);let n=r.find(e);if(n.length>0){let e=jQuery(n[0]).clone();const t=e.data(Service.SYSTEM_ACTION);let r=jQuery(e.html());return 1!==r.length&&(r=jQuery("<div></div>").append(e.html())),void 0!==t&&r.data(Service.SYSTEM_ACTION,t),r}{const e=jQuery("<div></div>");return e.append(Service.DefaultElementHandler(t)),e}}),Service.AddProperty("ExecuteCustom",function(e,t,r,n=null){return new Promise(function(a){if(null!=e&&e.length>0)return(e=e.split("|")).forEach(function(e){Service.Modification.hasOwnProperty(e)?Service.Modification[e](t,r,n):Controller.hasOwnProperty(e)&&Controller[e](t,r,n)}),a(!0);a(!1)})}),Service.AddProperty("Transform",function(e,t,r,n){return(e=e.split("|")).forEach(function(e){null===t?Service.Transformation.hasOwnProperty(e)?r=Service.Transformation[e](r,n):Controller.hasOwnProperty(e)&&(r=Controller[e](r,n)):Service.Transformation.hasOwnProperty(e)?Service.Transformation[e](t,r,n):Controller.hasOwnProperty(e)&&Controller[e](t,r,n)}),r}),Service.AddProperty("ExecuteSubmitTransformation",function(e,t,r,n){return(e=e.split("|")).forEach(function(e){Service.SubmitTransformation.hasOwnProperty(e)?r=Service.SubmitTransformation[e](t,r,n):Controller.hasOwnProperty(e)&&(t=Controller[e](t,r,n))}),r}),Service.AddProperty("LoadingStateOn",function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea").prop("disabled",!0),e.prop("disabled",!0)}),Service.AddProperty("LoadingStateOff",function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea").prop("disabled",!1),e.prop("disabled",!1)}),Service.AddProperty("LoadPanelTransition",function(e,t,r=null){e.css("display","none"),e.empty(),e.html(t).fadeIn("slow")}),Service.AddProperty("Bootstrap",function(e=null){Service.ModelData.List={},setTimeout(async function(){await Controller.PanelSelect(document.getElementById(`${MainContainer}`)),null!==e&&await Controller.PanelSelect(e[0])},1e3)}),Controller.AddProperty("FormSubmit",function(e,t){if(void 0!==t?t.preventDefault():window.event.preventDefault(),Service.ActionLoading)return!1;const r=jQuery(e);Service.ActionLoading=!0,Service.CanSubmitForm=!0;let n=r.data(Service.SYSTEM_TARGET),a=r.data(Service.SYSTEM_CUSTOM),i=r.data(Service.SYSTEM_COMPLETE),o=r.data(Service.SYSTEM_HEADERS),l="",c="",d=new FormData,S=[],s=[];if(void 0===n)n="",Service.LoadedForm=jQuery(r.parents("form"));else{const e=r.data(Service.SYSTEM_ACTION),t=r.data(Service.SYSTEM_METHOD);"#"!==n.substring(0,1)&&(n=`#${n}`);const a=jQuery(document).find(n);let i=a.is("form")?a:a.find("form");if(i.length>0)Service.LoadedForm=i,void 0!==e&&i.attr("action",e),void 0!==t&&i.attr("method",t);else{const r=a.clone();(i=jQuery("<form></form>",{action:e,method:t})).append(r.children());const n=a.find("select");jQuery(n).each(function(e){i.find("select").eq(e).val(jQuery(this).val())}),Service.LoadedForm=i}}if(Service.LoadedForm.length<=0)return Service.ActionLoading=!1,!1;if(void 0!==o&&Controller.hasOwnProperty(o)&&(S=Controller[o]()),s=jQuery(Service.LoadedForm.serializeArray()),jQuery.each(s,function(){d.append(this.name,this.value)}),l=Service.LoadedForm[0].action,c=Service.LoadedForm[0].method,void 0===l)return!1;void 0===c&&(c="POST"),c=c.toUpperCase();const u=Service.LoadedForm.find("input[type='file']");if(u.length>0&&jQuery(u).each(function(e){if(u[e].files.length>1){let t=u[e].name;"]"!==t.substring(t.length-1,t.length)&&(t=`${u[e].name}[]`);for(let r=0;r<u[e].files.length;r++)d.append(t,u[e].files[r])}else d.append(u[e].name,u[e].files[0])}),void 0!==a&&(d=Service.ExecuteSubmitTransformation(a,Service.LoadedForm,d)),!1===Service.CanSubmitForm)return Service.ActionLoading=!1,!1;let v=Service.SuccessHandler,p=Service.ErrorHandler,T=r.data(Service.SYSTEM_SUCCESS_HANDLER),f=r.data(Service.SYSTEM_ERROR_HANDLER);void 0!==T&&Controller.hasOwnProperty(T)&&(v=Controller[T]),void 0!==f&&Controller.hasOwnProperty(f)&&(p=Controller[f]);let E=Service.Action[n];void 0!==E?E({params:d,success:v,error:p,headers:S,complete:i,site:l,request:c,actionBtn:r,component:Service.LoadedForm}):Service.ServerRequest({params:d,success:v,error:p,headers:S,complete:i,site:l,request:c,actionBtn:r,component:Service.LoadedForm})}),Controller.AddProperty("FileSelect",function(e){if(Service.ActionLoading)return!1;const t=jQuery(e);Service.ActionLoading=!0;let r=t.data(Service.SYSTEM_ACTION),n=t.data(Service.SYSTEM_COMPLETE);const a=void 0===r?jQuery(t.parents(Service.SYSTEM_FILE_UPLOAD_CONTAINER)):jQuery(document).find(`#${r}`);let i=a.find("input[type=file]"),o=a.find("img");i.click(),i.change(function(){Service.ImagePreview(i,o)}),i.change(),void 0!==n&&Service.ExecuteCustom(n,a,t),Service.ActionLoading=!1}),Controller.AddProperty("ModalSelect",function(e){if(Service.ModalLoading)return!1;const t=jQuery(e);if(Service.ModalLoading=!0,t.data(Service.SYSTEM_LOAD_TYPE,"modal"),null===Service.LoadedModal){let e=t.data(Service.SYSTEM_ACTION);Service.FindElement(e,t).then(e=>{Service.LoadedModal=e,Service.LoadedModal.hasClass("modal")||(Service.LoadedModal=Service.DefaultModalHandler(e,t)),jQuery(`#${ModalContainer}`).empty().append(Service.LoadedModal);const r=t.data(),n=[Service.SYSTEM_ACTION,Service.SYSTEM_COMPLETE];jQuery.each(r,function(e,t){-1===jQuery.inArray(e,n)&&Service.LoadedModal.data(e,t)}),Service.ExecuteCustom(t.data(Service.SYSTEM_CUSTOM),Service.LoadedModal,t).then(()=>{Service.LaunchModal(Service.LoadedModal,t).then(()=>{Service.ExecuteCustom(t.data(Service.SYSTEM_COMPLETE),Service.LoadedModal,t).then(()=>{Service.ModalLoading=!1})})})})}else Service.ModalLoading=!1}),Controller.AddProperty("PanelSelect",function(e){const t=jQuery(e),r=t.data(Service.SYSTEM_ACTION);if(-1!==jQuery.inArray(r,Service.PanelLoading))return!1;Service.PanelLoading.push(t.data(Service.SYSTEM_ACTION)),t.data(Service.SYSTEM_LOAD_TYPE,"panel");const n=t.data(Service.SYSTEM_HISTORY);Service.FindElement(t.data(Service.SYSTEM_ACTION),t).then(e=>{const a={},i=[Service.SYSTEM_ACTION,Service.SYSTEM_COMPLETE,Service.SYSTEM_TARGET,Service.SYSTEM_CUSTOM,Service.SYSTEM_HISTORY,Service.SYSTEM_NOTIFICATION_ON_SUCCESS,Service.SYSTEM_NOTIFICATION_ON_ERROR,Service.SYSTEM_NOTIFICATION,Service.SYSTEM_TITLE];jQuery.each(t.data(),function(e,t){-1!==jQuery.inArray(e,i)?a[e]=t:"string"==typeof t&&(a[e]=t)}),void 0===n&&window.history.pushState({data:a,panelSelect:!0},"");const o=void 0!==t.data(Service.SYSTEM_TITLE)?t.data(Service.SYSTEM_TITLE):t.data(Service.SYSTEM_ACTION);window.document.title=`${Service.Title} - ${o}`,Service.ExecuteCustom(t.data(Service.SYSTEM_CUSTOM),Service.LoadedPanel,t).then(()=>{Service.LoadPanel(e,t,t.data(Service.SYSTEM_TARGET)).then(()=>{Service.ExecuteCustom(t.data(Service.SYSTEM_COMPLETE),Service.LoadedPanel,t).then(()=>{const e=Service.PanelLoading.indexOf(r);Service.PanelLoading.splice(e,1)})})})})}),Controller.AddProperty("ReloadPanel",function(){const e=jQuery("<button></button>",{type:"button","data-notification":"false"});Service.LoadPanel(Service.LoadedPanel,e)}),window.onpopstate=function(e){const t=e.state;if(null!==t&&t.panelSelect){const e=jQuery("<a>");jQuery.each(t.data,function(t,r){e.attr(`data-${t}`,r)}),e.attr("data-history",!0),Controller.PanelSelect(e[0])}};
