let MainContainer="MainContainer",ModalContainer="modal-container",TemplateContainer="container-panel";const HARD_RELOAD_HEADER="x-reload-app",HARD_REDIRECT_HEADER="x-redirect-app",TOASTER_NOTIFICATION_TYPE="toaster",ALERT_NOTIFICATION_TYPE="alert",NONE_NOTIFICATION_TYPE="none";window.Controller=function(){let e=function(e,r){t[e]=r},t={AddProperty:e,AddMethod:function(t,r){e(t,r)},FormSubmit:null,FileSelect:null,ModalSelect:null,PanelSelect:null};return t}(),window.Service=function(){let e=function(e,r){t[e]=r},t={LoadedModal:null,LoadedPanel:null,LoadedForm:null,PanelLoading:[],ModalLoading:null,ActionLoading:null,ModelData:{Lists:{},Listing:[],SelectedEntity:{}},MetaData:{},ContainerPanel:null,Title:"Javascript UI",Modification:null,SubmitTransformation:null,Transformation:null,DomEvents:null,Data:null,AuthorizationHandler:null,ErrorHandler:null,SuccessHandler:null,NotificationHandler:null,ErrorMessageHandler:null,ErrorDataHandler:null,SuccessMessageHandler:null,SuccessDataHandler:null,DefaultModalHandler:null,DefaultElementHandler:null,ServerRequest:null,LaunchModal:null,Bind:null,BindForm:null,BindList:null,GetProperty:null,ListUpdate:null,TriggerEvents:null,ImagePreview:null,LoadPanel:null,LoadLayout:null,LoadPanelTransition:null,SelectListBuilder:null,FindElement:null,Transform:null,ExecuteCustom:null,ExecuteSubmitTransformation:null,ReloadPanel:null,ToasterNotification:null,AlertNotification:null,LoadingStateOn:null,LoadingStateOff:null,CanSubmitForm:null,Bootstrap:null,AddProperty:e,AddMethod:function(t,r){e(t,r)},SYSTEM_ID:"id",SYSTEM_PROPERTY:"property",SYSTEM_TARGET:"target",SYSTEM_COMPLETE:"complete",SYSTEM_HEADERS:"headers",SYSTEM_ACTION:"action",SYSTEM_CUSTOM:"custom",SYSTEM_URL:"href",SYSTEM_METHOD:"method",SYSTEM_HISTORY:"history",SYSTEM_FILE_UPLOAD_CONTAINER:".file-upload",SYSTEM_CLEAR_ERROR:"clear-error",SYSTEM_CLEAR_SUCCESS:"clear-success",SYSTEM_LIST:"list",SYSTEM_BIND:"bind",SYSTEM_BIND_VALUE:"bind-value",SYSTEM_BIND_ELEM:"bind-element",SYSTEM_BIND_GLOBAL:"bind-global",SYSTEM_LOOP:"loop",SYSTEM_BIND_LOOP:"bind-loop",SYSTEM_SUCCESS_HANDLER:"success-handler",SYSTEM_ERROR_HANDLER:"error-handler",SYSTEM_LOAD_TYPE:"load-type",SYSTEM_NOTIFICATION_ON_SUCCESS:"notification-success",SYSTEM_NOTIFICATION_ON_ERROR:"notification-error",SYSTEM_NOTIFICATION:"notification",SYSTEM_TITLE:"title",SYSTEM_DEFAULT:"default"};return t}(),window.Service.AddProperty("Modification",function(){let e={AddMethod:function(t,r){e[t]=r}};return e}()),window.Service.AddProperty("SubmitTransformation",function(){let e={AddMethod:function(t,r){e[t]=r}};return e}()),window.Service.AddProperty("Transformation",function(){let e={AddMethod:function(t,r){e[t]=r}};return e}()),window.Service.AddProperty("Data",function(){let e={AddMethod:function(t,r){e[t]=r},Store:{}};return e}()),Service.AddProperty("AuthorizationHandler",(function(e){e.NotificationType="alert",Service.NotificationHandler(e)})),Service.AddProperty("ErrorHandler",(function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea,button").each((function(){let e=jQuery(this);e.hasClass(Service.SYSTEM_CLEAR_ERROR)&&("select-one"===e.prop("type")?e.prop("selectedIndex",0):(e.is("input")||e.is("textarea"))&&e.val(""))}))})),Service.AddProperty("SuccessHandler",(function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea,button").each((function(){let e=jQuery(this);e.hasClass(Service.SYSTEM_CLEAR_SUCCESS)&&("select-one"===e.prop("type")?e.prop("selectedIndex",0):(e.is("input")||e.is("textarea"))&&e.val(""))}))})),Service.AddProperty("NotificationHandler",(function(e){switch(e.NotificationType){case"alert":"function"==typeof Service.AlertNotification?Service.AlertNotification(e):alert(e.Message);break;case"toaster":"function"==typeof Service.ToasterNotification?Service.ToasterNotification(e):alert(e.Message);break;case"none":break;default:"success"===e.Status?"function"==typeof Service.ToasterNotification?Service.ToasterNotification(e):alert(e.Message):"function"==typeof Service.AlertNotification?Service.AlertNotification(e):alert(e.Message)}})),Service.AddProperty("DefaultElementHandler",(function(e){const t=jQuery("<div></div>",{class:"alert alert-danger"});return t.append("<p>The panel you are trying to load experienced an error while rendering....</p>"),t})),Service.AddProperty("DefaultModalHandler",(function(e,t){if(!e.hasClass("modal")){const t=e.find(".modal");if(1===t.length)return t;{let t=e.data(Service.SYSTEM_ACTION);"string"!=typeof t&&(t="");const r=e.html();return jQuery(`<div class="modal fade" role="dialog" data-action="${t}">\n                    <div class="modal-dialog">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <button type="button" class="close" data-dismiss="modal">&times;</button>\n                                <h4 class="modal-title"></h4>\n                            </div>\n                            <div class="modal-body">\n                                ${r}\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>`)}}})),Service.AddProperty("ErrorMessageHandler",(function(e,t,r){return t})),Service.AddProperty("ErrorDataHandler",(function(e,t,r){let n={};if(e.responseJSON.length>0)return e.responseJSON;if(e.responseText.length>0)try{n=JSON.parse(e.responseText)}catch(e){n={}}return n})),Service.AddProperty("SuccessMessageHandler",(function(e,t,r){return e.statusText})),Service.AddProperty("SuccessDataHandler",(function(e,t,r){return t})),Service.AddProperty("ServerRequest",(function(e){e.Request=void 0!==e.Request&&null!==e.Request&&e.Request?e.Request.toUpperCase():e.Method.toUpperCase()||"POST",void 0!==e.Headers&&null!==e.Headers&&e.Headers||(e.Headers=[]),void 0!==e.SuccessHandler&&null!==e.SuccessHandler&&e.SuccessHandler||(e.SuccessHandler=Service.SuccessHandler),void 0!==e.ErrorHandler&&null!==e.ErrorHandler&&e.ErrorHandler||(e.ErrorHandler=Service.ErrorHandler),void 0!==e.Component&&null!==e.Component&&e.Component||(e.Component=jQuery("<div></div>")),void 0!==e.ResponseType&&null!==e.ResponseType&&e.ResponseType||(e.ResponseType="json"),void 0!==e.ActionBtn&&null!==e.ActionBtn&&e.ActionBtn||(e.ActionBtn=jQuery("<button></button>",{type:"button"})),null===e.Params&&(e.Params={}),Service.LoadingStateOn(e.ActionBtn);const t=function(t,r,n){if(Service.LoadingStateOff(e.ActionBtn),n.getResponseHeader("x-reload-app"))return void location.reload();if(n.getResponseHeader("x-redirect-app"))return void(location.href=n.getResponseHeader("x-redirect-app"));let i=new Result;i.Code=n.statusCode,i.Status=r,i.Data=Service.SuccessDataHandler(n,t,e.ActionBtn),i.Message=Service.SuccessMessageHandler(n,t,e.ActionBtn),i.ActionBtn=e.ActionBtn,i.Component=e.Component,void 0!==e.ActionBtn.data(Service.SYSTEM_NOTIFICATION)&&"true"!==e.ActionBtn.data(Service.SYSTEM_NOTIFICATION)&&"success"!==e.ActionBtn.data(Service.SYSTEM_NOTIFICATION)||(i.NotificationType=e.ActionBtn.data(Service.SYSTEM_NOTIFICATION_ON_SUCCESS)||"toaster",Service.NotificationHandler(i)),e.SuccessHandler(i),null===e.Complete&&(e.Complete=e.ActionBtn.Data(Service.SYSTEM_COMPLETE)),Service.ExecuteCustom(e.Complete,e.Component,e.ActionBtn,i).then((()=>{Service.ActionLoading=!1}))},r={url:e.Site,type:e.Request,success:t,error:function(r,n,i){if(200===r.status)return void t({},"success",r);const a=new Result;if(a.Code=r.status,a.Status=n,a.ActionBtn=e.ActionBtn,a.Component=e.Component,Service.LoadingStateOff(e.ActionBtn),a.Data=Service.ErrorDataHandler(r,i,e.ActionBtn),a.Message=Service.ErrorMessageHandler(r,i,e.ActionBtn),401===r.status||403===r.status)return Service.AuthorizationHandler(a),void(Service.ActionLoading=!1);e.ErrorHandler(a),null===e.Complete&&(e.Complete=e.ActionBtn.data(Service.SYSTEM_COMPLETE)),Service.ExecuteCustom(e.Complete,e.Component,e.ActionBtn,a).then((()=>{void 0!==e.ActionBtn.data(Service.SYSTEM_NOTIFICATION)&&"true"!==e.ActionBtn.data(Service.SYSTEM_NOTIFICATION)&&"error"!==e.ActionBtn.data(Service.SYSTEM_NOTIFICATION)||(a.NotificationType=e.ActionBtn.data(Service.SYSTEM_NOTIFICATION_ON_ERROR)||"alert",Service.NotificationHandler(a)),Service.ActionLoading=!1}))},beforeSend:function(t){t.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.Headers.length>0&&jQuery.each(e.Headers,(function(){t.setRequestHeader(this.Name,this.Value)}))}};["POST","PUT","HEAD","DELETE"].indexOf(e.Request.toUpperCase())>=0&&(r.data=e.Params),r.dataType=e.ResponseType,r.processData=!1,r.contentType=!1,r.global=!1,jQuery.ajax(r)})),Service.AddProperty("LaunchModal",(function(e,t){return new Promise((function(r){e.on("hide.bs.modal",(function(e){})),e.on("hidden.bs.modal",(function(){Service.LoadedModal.remove(),Service.LoadedModal=null,jQuery(`.${ModalContainer}`).empty()}));const n=e.data(Service.SYSTEM_ACTION);if("string"==typeof n){let i=Service.Data[n];void 0===i&&(i=Service.Data[`${n}-data`]),void 0!==i?i(e,t).then((()=>{e.modal(),r(!0)})):(e.modal(),r(!0))}else e.modal(),r(!0)}))})),Service.AddProperty("Bind",(function(e,t,r=null){let n=e.find(`.${Service.SYSTEM_BIND}`);jQuery.each(n,(function(){let e=jQuery(this);if(e.hasClass(Service.SYSTEM_BIND_GLOBAL)){if(void 0!==e.data(Service.SYSTEM_CUSTOM)){e.data(Service.SYSTEM_CUSTOM).split("|").forEach((function(n){Service.Transformation.hasOwnProperty(n)?Service.Transformation[n](e,t,r):Controller.hasOwnProperty(n)&&Controller[n](e,t,r)}))}}else if("IMG"===e.prop("tagName"))void 0!==e.data(Service.SYSTEM_PROPERTY)?e.prop("src",Service.GetProperty(e.data(Service.SYSTEM_PROPERTY),t)):void 0!==e.prop("id")&&e.prop("src",Service.GetProperty(e.prop("id"),t));else if(void 0!==e.data(Service.SYSTEM_PROPERTY)){let n=Service.GetProperty(e.data(Service.SYSTEM_PROPERTY),t);if(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||(n=Service.Transform(e.data(Service.SYSTEM_CUSTOM),null,n,r))),e.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n,r);else if(e.hasClass(Service.SYSTEM_BIND_VALUE)){if(e.is("input,select,textarea")&&e.val(n),e.attr("data-value",n),e.data("value",n),"SELECT"===e.prop("tagName")){let t=e.find("option");e.prop("selectedIndex",0),t.each((function(t){this.value==n&&e.prop("selectedIndex",t)}))}}else e.html(n)}else if(void 0!==e.data(Service.SYSTEM_LOOP)){let n=Service.GetProperty(e.data(Service.SYSTEM_LOOP),t),i=e.children();e.empty(),"object"==typeof n&&null!==n&&n.length>0&&n.forEach((function(t){let n=i.clone(),a=n.find(`.${Service.SYSTEM_BIND_LOOP}`);$.each(a,(function(){let e=jQuery(this);if(void 0!==e.data(Service.SYSTEM_PROPERTY)){let n=Service.GetProperty(e.data(Service.SYSTEM_PROPERTY),t);if(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||(n=Service.Transform(e.data(Service.SYSTEM_CUSTOM),null,n,r))),e.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n,r);else if(e.hasClass(Service.SYSTEM_BIND_VALUE)){if(e.is("input,select,textarea")&&e.val(n),e.attr("data-value",n),e.data("value",n),"SELECT"===e.prop("tagName")){let t=e.find("option");e.prop("selectedIndex",0),t.each((function(t){this.value==n&&e.prop("selectedIndex",t)}))}}else e.html(n)}else{let n=Service.GetProperty(e.prop("id"),t);if(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||(n=Service.Transform(e.data(Service.SYSTEM_CUSTOM),null,n,r))),e.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n,r);else if(e.hasClass(Service.SYSTEM_BIND_VALUE)){if(e.is("input,select,textarea")&&e.val(n),e.attr("data-value",n),e.data("value",n),"SELECT"===e.prop("tagName")){let t=e.find("option");e.prop("selectedIndex",0),t.each((function(t){this.value==n&&e.prop("selectedIndex",t)}))}}else e.html(n)}})),e.append(n)})),void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e=Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,r))}else{let n=Service.GetProperty(e.prop("id"),t);if(void 0!==e.data(Service.SYSTEM_CUSTOM)&&(e.hasClass(Service.SYSTEM_BIND_ELEM)||(n=Service.Transform(e.data(Service.SYSTEM_CUSTOM),null,n,r))),e.hasClass(Service.SYSTEM_BIND_ELEM))Service.Transform(e.data(Service.SYSTEM_CUSTOM),e,n,r);else if(e.hasClass(Service.SYSTEM_BIND_VALUE)){if(e.is("input,select,textarea")&&e.val(n),e.attr("data-value",n),e.data("value",n),"SELECT"===e.prop("tagName")){let t=e.find("option");e.prop("selectedIndex",0),t.each((function(t){this.value==n&&e.prop("selectedIndex",t)}))}}else e.html(n)}}))})),Service.AddProperty("BindForm",(function(e,t){if(null===t)return;if(void 0===e)return;let r=jQuery(e).find("input,select,textarea");if(!(r.length<=0)){for(let e=0;e<r.length;e++){let n=null,i=jQuery(r[e]);if(n=Service.GetProperty(i.prop("id"),t),null!=n&&"object"!=typeof n||(n=Service.GetProperty(i.prop("name"),t)),"select-one"===i[0].type){let e=i.data(Service.SYSTEM_LIST);if(void 0!==e){let r=Service.ModelData.List[e];void 0===r&&(r=Service.GetProperty(e,t)),null!=r&&r.length>0?Service.SelectListBuilder(i,r):i.data(Service.SYSTEM_DEFAULT)&&Service.SelectListBuilder(i,[])}}if(null!=n&&"object"!=typeof n)switch(i[0].type){case"checkbox":case"radio":i.prop("checked",n==i.val());break;case"date":if(n){let e=new Date(n),t=("0"+e.getDate()).slice(-2),r=("0"+(e.getMonth()+1)).slice(-2);e=e.getFullYear()+"-"+r+"-"+t,i.data("value",e),i.val(e)}else i.val("");break;case"select-one":{i.data("value",n);let e=i.find("option");i.prop("selectedIndex",0),e.each((function(e){this.value==n&&i.prop("selectedIndex",e)}));break}case"select-multiple":break;default:i.data("value",n),i.val(n)}}for(let e=0;r&&e<r.length;e++)Service.TriggerEvents(jQuery(r[e]))}})),Service.AddProperty("BindList",(function(e,t=[],r=null){if(void 0!==t&&"string"!=typeof t&&null!==t&&"object"==typeof t&&t.length>0)Service.SelectListBuilder(e,t);else{const t=e.find("select");jQuery.each(t,(function(){let e=jQuery(this),t=e.data(Service.SYSTEM_LIST);if(void 0!==t){let n=Service.GetProperty(t,Service.ModelData.Lists);(null==n||n.length<=0)&&Controller.hasOwnProperty(t)&&(n=Controller[t](r)),null!=n&&n.length>0?Service.SelectListBuilder(e,n):e.data(Service.SYSTEM_DEFAULT)&&Service.SelectListBuilder(e,[])}else Service.SelectListBuilder(e,[])}))}})),Service.AddProperty("GetProperty",(function(e,t){if(null===e)return t;if(void 0===e)return t;e=e.split(".");let r=t;if(void 0===r)return null;for(let t=0;t<e.length&&!(e[t].length<=0)&&(r=r[e[t]],null!==r)&&void 0!==r;t++)if("object"!=typeof r)return r;return r})),Service.AddProperty("TriggerEvents",(function(e){let t=e.prop("onclick"),r=e.prop("onchange"),n=e.prop("onblur");null!==t&&e.click(),null!==r&&e.change(),null!==n&&e.blur()})),Service.AddProperty("ImagePreview",(function(e,t){if(1===e.length&&e[0].files[0]){let r=new FileReader;r.onload=function(e){t.prop("src",e.target.result)},r.readAsDataURL(e[0].files[0])}})),Service.AddProperty("LoadPanel",(function(e,t,r){return new Promise((n=>{if(void 0!==e&&"object"==typeof e){const i=jQuery("<div></div>");let a=e.data(Service.SYSTEM_ACTION);if(Service.Data.hasOwnProperty(a)||(a=`${t[0].dataset[Service.SYSTEM_ACTION]}-data`),!Service.Data.hasOwnProperty(a)){Service.ContainerPanel=jQuery(`#${TemplateContainer}`),Service.ContainerPanel.length<=0&&(jQuery("<body>").append(i),Service.ContainerPanel=i),Service.ContainerPanel.empty().append(e);let t=null!=r&&r.length>0?jQuery(`#${r}`):jQuery(`#${MainContainer}`);return Service.LoadPanelTransition(t,e),Service.ContainerPanel.empty(),Service.ContainerPanel=null,Service.LoadedPanel=e,i.empty().remove(),n(!0)}Service.Data[a](e,t).then((()=>{Service.ContainerPanel=jQuery(`#${TemplateContainer}`),Service.ContainerPanel.length<=0&&(jQuery("<body>").append(i),Service.ContainerPanel=i),Service.ContainerPanel.empty().append(e);let t=null!=r&&r.length>0?jQuery(`#${r}`):jQuery(`#${MainContainer}`);return Service.LoadPanelTransition(t,e),Service.ContainerPanel.empty(),Service.ContainerPanel=null,Service.LoadedPanel=e,i.empty().remove(),n(!0)}))}n(!1)}))})),Service.AddProperty("SelectListBuilder",(function(e,t,r,n=!0){"string"==typeof e&&("#"!==e.substring(0,1)&&(e=`#${e}`),e=jQuery(e)),n&&e.empty();const i=e.data("default");i&&e.append(`<option data-value="" value=""> ${i} </option>`),jQuery.each(t,(function(){e.append(`<option data-value="${this.Value}" value="${this.Value}"> ${this.Text} </option>`)}))})),Service.AddProperty("FindElement",(function(e,t=null){return new Promise((r=>{let n=jQuery("template").prop("content");n=jQuery(n);let i="";if(void 0!==e&&e.length>0&&("#"!==e.substring(0,1)&&(e=`#${e}`),i=n.find(e)),i.length>0){let e=jQuery(i[0]).clone();const n=e.data(Service.SYSTEM_ACTION);let a=jQuery(e.html());1!==a.length&&(a=jQuery("<div></div>").append(e.html())),void 0!==n&&a.data(Service.SYSTEM_ACTION,n),Service.BindList(a,[],t),r(a)}else{const e=jQuery("<div></div>");e.append(Service.DefaultElementHandler(t)),r(e)}}))})),Service.AddProperty("ExecuteCustom",(function(e,t,r,n=null){return new Promise((function(i){if(null!=e&&e.length>0)return(e=e.split("|")).forEach((function(e){Service.Modification.hasOwnProperty(e)?Service.Modification[e](t,r,n):Controller.hasOwnProperty(e)&&Controller[e](t,r,n)})),i(!0);i(!1)}))})),Service.AddProperty("Transform",(function(e,t,r,n){return"string"==typeof e&&e.length>0&&(e=e.split("|")).forEach((function(e){null===t?Service.Transformation.hasOwnProperty(e)?r=Service.Transformation[e](r,n):Controller.hasOwnProperty(e)&&(r=Controller[e](r,n)):Service.Transformation.hasOwnProperty(e)?Service.Transformation[e](t,r,n):Controller.hasOwnProperty(e)&&Controller[e](t,r,n)})),r})),Service.AddProperty("ExecuteSubmitTransformation",(function(e,t,r,n){return(e=e.split("|")).forEach((function(e){Service.SubmitTransformation.hasOwnProperty(e)?r=Service.SubmitTransformation[e](t,r,n):Controller.hasOwnProperty(e)&&(t=Controller[e](t,r,n))})),r})),Service.AddProperty("LoadingStateOn",(function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea").prop("disabled",!0),e.prop("disabled",!0)})),Service.AddProperty("LoadingStateOff",(function(e){null!==Service.LoadedForm&&Service.LoadedForm.find("input,select,textarea").prop("disabled",!1),e.prop("disabled",!1)})),Service.AddProperty("LoadPanelTransition",(function(e,t,r=null){e.css("display","none"),e.empty(),e.html(t).fadeIn("slow")})),Service.AddProperty("Bootstrap",(function(e=null){setTimeout((async function(){await Controller.PanelSelect(document.getElementById(`${MainContainer}`)),null!==e&&await Controller.PanelSelect(e[0])}),1e3)})),Controller.AddProperty("FormSubmit",(function(e,t){if(void 0!==t?t.preventDefault():window.event.preventDefault(),Service.ActionLoading)return!1;const r=jQuery(e);Service.ActionLoading=!0,Service.CanSubmitForm=!0;let n=r.data(Service.SYSTEM_TARGET),i=r.data(Service.SYSTEM_CUSTOM),a=r.data(Service.SYSTEM_COMPLETE),o=r.data(Service.SYSTEM_HEADERS),l=[],c=r.data(Service.SYSTEM_URL),S="post",d=new FormData,s=[],u=[];if(void 0===n)Service.LoadedForm=jQuery(r.parents("form")),void 0!==Service.LoadedForm.attr("action")&&(c=Service.LoadedForm.attr("action")),void 0!==Service.LoadedForm.attr("method")&&(S=Service.LoadedForm.attr("method"));else{"#"!==n.substring(0,1)&&(n=`#${n}`);const e=jQuery(document).find(n);if(l=e.is("form")?e:e.find("form"),l.length>0)Service.LoadedForm=l,void 0!==l.data(Service.SYSTEM_URL)&&(c=l.data(Service.SYSTEM_URL)),void 0!==l.data(Service.SYSTEM_METHOD)&&(S=l.data(Service.SYSTEM_METHOD));else{const t=e.clone();l=jQuery("<form></form>"),l.append(t.children());const r=e.find("select");jQuery(r).each((function(e){l.find("select").eq(e).val(jQuery(this).val())})),void 0!==e.data(Service.SYSTEM_URL)&&(c=e.data(Service.SYSTEM_URL)),void 0!==e.data(Service.SYSTEM_METHOD)&&(S=e.data(Service.SYSTEM_METHOD)),Service.LoadedForm=e}}if(Service.LoadedForm.length<=0)return Service.ActionLoading=!1,!1;if(void 0!==o&&Controller.hasOwnProperty(o)&&(s=Controller[o]()),u=jQuery(l.serializeArray()),jQuery.each(u,(function(){d.append(this.name,this.value)})),void 0===c||c.length<=0)return Service.ActionLoading=!1,!1;S=S.toUpperCase();const v=l.find("input[type='file']");if(v.length>0&&jQuery(v).each((function(e){if(v[e].files.length>1){let t=v[e].name;"]"!==t.substring(t.length-1,t.length)&&(t=`${v[e].name}[]`);for(let r=0;r<v[e].files.length;r++)d.append(t,v[e].files[r])}else d.append(v[e].name,v[e].files[0])})),void 0!==i&&(d=Service.ExecuteSubmitTransformation(i,Service.LoadedForm,d,r)),!1===Service.CanSubmitForm)return Service.ActionLoading=!1,!1;let p=Service.SuccessHandler,T=Service.ErrorHandler,E=r.data(Service.SYSTEM_SUCCESS_HANDLER),f=r.data(Service.SYSTEM_ERROR_HANDLER);void 0!==E&&Controller.hasOwnProperty(E)&&(p=Controller[E]),void 0!==f&&Controller.hasOwnProperty(f)&&(T=Controller[f]);const M=new Requirement;M.Params=d,M.SuccessHandler=p,M.ErrorHandler=T,M.Complete=a,M.Site=c,M.Request=S,M.ActionBtn=r,M.Component=Service.LoadedForm,M.Headers=s,Service.ServerRequest(M)})),Controller.AddProperty("FileSelect",(function(e){if(Service.ActionLoading)return!1;const t=jQuery(e);Service.ActionLoading=!0;let r=t.data(Service.SYSTEM_TARGET),n=t.data(Service.SYSTEM_COMPLETE);const i=void 0===r?jQuery(t.parents(Service.SYSTEM_FILE_UPLOAD_CONTAINER)):jQuery(document).find(`#${r}`);let a=i.find("input[type=file]"),o=i.find("img");a.click(),a.change((function(){Service.ImagePreview(a,o)})),a.change(),void 0!==n&&Service.ExecuteCustom(n,i,t),Service.ActionLoading=!1})),Controller.AddProperty("ModalSelect",(function(e){if(Service.ModalLoading)return!1;const t=jQuery(e);if(Service.ModalLoading=!0,t.data(Service.SYSTEM_LOAD_TYPE,"modal"),null===Service.LoadedModal){let e=t.data(Service.SYSTEM_ACTION);Service.FindElement(e,t).then((e=>{Service.LoadedModal=e,Service.LoadedModal.hasClass("modal")||(Service.LoadedModal=Service.DefaultModalHandler(e,t));jQuery(`#${ModalContainer}`).empty().append(Service.LoadedModal);const r=t.data(),n=[Service.SYSTEM_ACTION,Service.SYSTEM_COMPLETE];jQuery.each(r,(function(e,t){-1===jQuery.inArray(e,n)&&Service.LoadedModal.data(e,t)})),Service.ExecuteCustom(t.data(Service.SYSTEM_CUSTOM),Service.LoadedModal,t).then((()=>{Service.LaunchModal(Service.LoadedModal,t).then((()=>{Service.ExecuteCustom(t.data(Service.SYSTEM_COMPLETE),Service.LoadedModal,t).then((()=>{Service.ModalLoading=!1}))}))}))}))}else Service.ModalLoading=!1})),Controller.AddProperty("PanelSelect",(function(e){const t=jQuery(e),r=t.data(Service.SYSTEM_ACTION);if(-1!==jQuery.inArray(r,Service.PanelLoading))return!1;Service.PanelLoading.push(t.data(Service.SYSTEM_ACTION)),t.data(Service.SYSTEM_LOAD_TYPE,"panel");const n=t.data(Service.SYSTEM_HISTORY);Service.FindElement(t.data(Service.SYSTEM_ACTION),t).then((e=>{const i={},a=[Service.SYSTEM_ACTION,Service.SYSTEM_COMPLETE,Service.SYSTEM_TARGET,Service.SYSTEM_CUSTOM,Service.SYSTEM_HISTORY,Service.SYSTEM_NOTIFICATION_ON_SUCCESS,Service.SYSTEM_NOTIFICATION_ON_ERROR,Service.SYSTEM_NOTIFICATION,Service.SYSTEM_TITLE];jQuery.each(t.data(),(function(e,t){(-1!==jQuery.inArray(e,a)||"string"==typeof t)&&(i[e]=t)})),void 0===n&&window.history.pushState({data:i,panelSelect:!0},"");const o=void 0!==t.data(Service.SYSTEM_TITLE)?t.data(Service.SYSTEM_TITLE):t.data(Service.SYSTEM_ACTION);window.document.title=`${Service.Title} - ${o}`,Service.ExecuteCustom(t.data(Service.SYSTEM_CUSTOM),Service.LoadedPanel,t).then((()=>{Service.LoadPanel(e,t,t.data(Service.SYSTEM_TARGET)).then((()=>{Service.ExecuteCustom(t.data(Service.SYSTEM_COMPLETE),Service.LoadedPanel,t).then((()=>{const e=Service.PanelLoading.indexOf(r);Service.PanelLoading.splice(e,1)}))}))}))}))})),Controller.AddProperty("ReloadPanel",(function(){const e=jQuery("<button></button>",{type:"button","data-notification":"false"});Service.LoadPanel(Service.LoadedPanel,e)})),window.onpopstate=function(e){const t=e.state;if(null!==t&&t.panelSelect){const e=jQuery("<a>");jQuery.each(t.data,(function(t,r){e.attr(`data-${t}`,r)})),e.attr("data-history",!0),Controller.PanelSelect(e[0])}};